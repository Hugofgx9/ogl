!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).myLibrary={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e,i,r,n,a,s){try{var o=t[a](s),h=o.value}catch(t){return void i(t)}o.done?e(h):Promise.resolve(h).then(r,n)}function r(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var s=t.apply(e,r);function o(t){i(s,n,a,o,h,"next",t)}function h(t){i(s,n,a,o,h,"throw",t)}o(void 0)}))}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function c(t,e,i){return(c=l()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&u(n,i.prototype),n}).apply(null,arguments)}function d(t){var e="function"==typeof Map?new Map:void 0;return(d=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return c(t,arguments,h(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)})(t)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return f(t)}function p(t){var e=l();return function(){var i,r=h(t);if(e){var n=h(this).constructor;i=Reflect.construct(r,arguments,n)}else i=r.apply(this,arguments);return v(this,i)}}function g(t,e,i){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(r){var n=Object.getOwnPropertyDescriptor(r,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==i)return;var r,n,a=[],s=!0,o=!1;try{for(i=i.call(t);!(s=(r=i.next()).done)&&(a.push(r.value),!e||a.length!==e);s=!0);}catch(t){o=!0,n=t}finally{try{s||null==i.return||i.return()}finally{if(o)throw n}}return a}(t,e)||w(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){if(t){if("string"==typeof t)return x(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?x(t,e):void 0}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function b(t){var e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function A(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function M(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function E(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function k(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function T(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function F(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function _(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function R(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function S(t,e){var i=e[0],r=e[1],n=e[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function P(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function L(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],h=i[2];return t[0]=n*h-a*o,t[1]=a*s-r*h,t[2]=r*o-n*s,t}var O,C,B=(O=[0,0,0],C=[0,0,0],function(t,e){A(O,t),A(C,e),S(O,O),S(C,C);var i=P(O,C);return i>1?0:i<-1?Math.PI:Math.acos(i)});var I=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r;return n(this,i),v(t=e.call(this,r,a,s),f(t))}return s(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(M(this,t,e,i),this)}},{key:"copy",value:function(t){return A(this,t),this}},{key:"add",value:function(t,e){return e?E(this,t,e):E(this,this,t),this}},{key:"sub",value:function(t,e){return e?k(this,t,e):k(this,this,t),this}},{key:"multiply",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2]):T(this,this,t),this}},{key:"divide",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2]):T(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return R(this,t),this}},{key:"len",value:function(){return b(this)}},{key:"distance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],Math.sqrt(r*r+n*n+a*a)):b(this);var e,i,r,n,a}},{key:"squaredLen",value:function(){return F(this)}},{key:"squaredDistance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],r*r+n*n+a*a):F(this);var e,i,r,n,a}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return _(this,t),this}},{key:"cross",value:function(t,e){return e?L(this,t,e):L(this,this,t),this}},{key:"scale",value:function(t){return T(this,this,t),this}},{key:"normalize",value:function(){return S(this,this),this}},{key:"dot",value:function(t){return P(this,t)}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}},{key:"applyMatrix4",value:function(t){var e,i,r,n,a,s,o;return e=this,r=t,n=(i=this)[0],a=i[1],s=i[2],o=(o=r[3]*n+r[7]*a+r[11]*s+r[15])||1,e[0]=(r[0]*n+r[4]*a+r[8]*s+r[12])/o,e[1]=(r[1]*n+r[5]*a+r[9]*s+r[13])/o,e[2]=(r[2]*n+r[6]*a+r[10]*s+r[14])/o,this}},{key:"scaleRotateMatrix4",value:function(t){var e,i,r,n,a,s,o;return e=this,r=t,n=(i=this)[0],a=i[1],s=i[2],o=(o=r[3]*n+r[7]*a+r[11]*s+r[15])||1,e[0]=(r[0]*n+r[4]*a+r[8]*s)/o,e[1]=(r[1]*n+r[5]*a+r[9]*s)/o,e[2]=(r[2]*n+r[6]*a+r[10]*s)/o,this}},{key:"applyQuaternion",value:function(t){return function(t,e,i){var r=e[0],n=e[1],a=e[2],s=i[0],o=i[1],h=i[2],u=o*a-h*n,l=h*r-s*a,c=s*n-o*r,d=o*c-h*l,f=h*u-s*c,v=s*l-o*u,p=2*i[3];u*=p,l*=p,c*=p,d*=2,f*=2,v*=2,t[0]=r+u+d,t[1]=n+l+f,t[2]=a+c+v}(this,this,t),this}},{key:"angle",value:function(t){return B(this,t)}},{key:"lerp",value:function(t,e){return function(t,e,i,r){var n=e[0],a=e[1],s=e[2];t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a),t[2]=s+r*(i[2]-s)}(this,this,t,e),this}},{key:"clone",value:function(){return new i(this[0],this[1],this[2])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}},{key:"transformDirection",value:function(t){var e=this[0],i=this[1],r=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*r,this[1]=t[1]*e+t[5]*i+t[9]*r,this[2]=t[2]*e+t[6]*i+t[10]*r,this.normalize()}}]),i}(d(Array)),U=new I,N=1,z=1,D=!1,G=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in n(this,t),e.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=e,this.attributes=i,this.id=N++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state,i)this.addAttribute(r,i[r])}return s(t,[{key:"addAttribute",value:function(t,e){if(this.attributes[t]=e,e.id=z++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),this.updateAttribute(e)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}},{key:"updateAttribute",value:function(t){this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}},{key:"setIndex",value:function(t){this.addAttribute("index",t)}},{key:"setDrawRange",value:function(t,e){this.drawRange.start=t,this.drawRange.count=e}},{key:"setInstancedCount",value:function(t){this.instancedCount=t}},{key:"createVAO",value:function(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}},{key:"bindAttributes",value:function(t){var e=this;t.attributeLocations.forEach((function(t,i){var r=i.name,n=i.type;if(e.attributes[r]){var a=e.attributes[r];e.gl.bindBuffer(a.target,a.buffer),e.glState.boundBuffer=a.buffer;var s=1;35674===n&&(s=2),35675===n&&(s=3),35676===n&&(s=4);for(var o=a.size/s,h=1===s?0:s*s*s,u=1===s?0:s*s,l=0;l<s;l++)e.gl.vertexAttribPointer(t+l,o,a.type,a.normalized,a.stride+h,a.offset+l*u),e.gl.enableVertexAttribArray(t+l),e.gl.renderer.vertexAttribDivisor(t+l,a.divisor)}else console.warn("active attribute ".concat(r," not being supplied"))})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}},{key:"draw",value:function(t){var e=this,i=t.program,r=t.mode,n=void 0===r?this.gl.TRIANGLES:r;this.gl.renderer.currentGeometry!=="".concat(this.id,"_").concat(i.attributeOrder)&&(this.VAOs[i.attributeOrder]||this.createVAO(i),this.gl.renderer.bindVertexArray(this.VAOs[i.attributeOrder]),this.gl.renderer.currentGeometry="".concat(this.id,"_").concat(i.attributeOrder)),i.attributeLocations.forEach((function(t,i){var r=i.name,n=e.attributes[r];n.needsUpdate&&e.updateAttribute(n)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(n,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(n,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(n,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(n,this.drawRange.start,this.drawRange.count)}},{key:"getPosition",value:function(){var t=this.attributes.position;return t.data?t:D?void 0:(console.warn("No position buffer data found to compute bounds"),D=!0)}},{key:"computeBoundingBox",value:function(t){t||(t=this.getPosition());var e=t.data,i=t.offset||0,r=t.stride||t.size;this.bounds||(this.bounds={min:new I,max:new I,center:new I,scale:new I,radius:1/0});var n=this.bounds.min,a=this.bounds.max,s=this.bounds.center,o=this.bounds.scale;n.set(1/0),a.set(-1/0);for(var h=i,u=e.length;h<u;h+=r){var l=e[h],c=e[h+1],d=e[h+2];n.x=Math.min(l,n.x),n.y=Math.min(c,n.y),n.z=Math.min(d,n.z),a.x=Math.max(l,a.x),a.y=Math.max(c,a.y),a.z=Math.max(d,a.z)}o.sub(a,n),s.add(n,a).divide(2)}},{key:"computeBoundingSphere",value:function(t){t||(t=this.getPosition());var e=t.data,i=t.offset||0,r=t.stride||t.size;this.bounds||this.computeBoundingBox(t);for(var n=0,a=i,s=e.length;a<s;a+=r)U.fromArray(e,a),n=Math.max(n,this.bounds.center.squaredDistance(U));this.bounds.radius=Math.sqrt(n)}},{key:"remove",value:function(){for(var t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(var e in this.attributes)this.gl.deleteBuffer(this.attributes[e].buffer),delete this.attributes[e]}}]),t}(),j=1,V={},X=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.vertex,a=i.fragment,s=i.uniforms,o=void 0===s?{}:s,h=i.transparent,u=void 0!==h&&h,l=i.cullFace,c=void 0===l?e.BACK:l,d=i.frontFace,f=void 0===d?e.CCW:d,v=i.depthTest,p=void 0===v||v,g=i.depthWrite,m=void 0===g||g,y=i.depthFunc,w=void 0===y?e.LESS:y;n(this,t),e.canvas||console.error("gl not passed as fist argument to Program"),this.gl=e,this.uniforms=o,this.id=j++,r||console.warn("vertex shader not supplied"),a||console.warn("fragment shader not supplied"),this.transparent=u,this.cullFace=c,this.frontFace=f,this.depthTest=p,this.depthWrite=m,this.depthFunc=w,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));var x=e.createShader(e.VERTEX_SHADER);e.shaderSource(x,r),e.compileShader(x),""!==e.getShaderInfoLog(x)&&console.warn("".concat(e.getShaderInfoLog(x),"\nVertex Shader\n").concat(Y(r)));var b=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(b,a),e.compileShader(b),""!==e.getShaderInfoLog(b)&&console.warn("".concat(e.getShaderInfoLog(b),"\nFragment Shader\n").concat(Y(a))),this.program=e.createProgram(),e.attachShader(this.program,x),e.attachShader(this.program,b),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))return console.warn(e.getProgramInfoLog(this.program));e.deleteShader(x),e.deleteShader(b),this.uniformLocations=new Map;for(var A=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),M=0;M<A;M++){var E=e.getActiveUniform(this.program,M);this.uniformLocations.set(E,e.getUniformLocation(this.program,E.name));var k=E.name.match(/(\w+)/g);E.uniformName=k[0],3===k.length?(E.isStructArray=!0,E.structIndex=Number(k[1]),E.structProperty=k[2]):2===k.length&&isNaN(Number(k[1]))&&(E.isStruct=!0,E.structProperty=k[1])}this.attributeLocations=new Map;for(var T=[],F=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES),_=0;_<F;_++){var R=e.getActiveAttrib(this.program,_),S=e.getAttribLocation(this.program,R.name);T[S]=R.name,this.attributeLocations.set(R,S)}this.attributeOrder=T.join("")}return s(t,[{key:"setBlendFunc",value:function(t,e,i,r){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)}},{key:"setBlendEquation",value:function(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}},{key:"applyState",value:function(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}},{key:"use",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.flipFaces,r=void 0!==i&&i,n=-1,a=this.gl.renderer.currentProgram===this.id;a||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((function(e,i){var r=i.uniformName,a=t.uniforms[r];if(i.isStruct&&(a=a[i.structProperty],r+=".".concat(i.structProperty)),i.isStructArray&&(a=a[i.structIndex][i.structProperty],r+="[".concat(i.structIndex,"].").concat(i.structProperty)),!a)return H("Active uniform ".concat(r," has not been supplied"));if(a&&void 0===a.value)return H("".concat(r," uniform is missing a value parameter"));if(a.value.texture)return n+=1,a.value.update(n),q(t.gl,i.type,e,n);if(a.value.length&&a.value[0].texture){var s=[];return a.value.forEach((function(t){n+=1,t.update(n),s.push(n)})),q(t.gl,i.type,e,s)}q(t.gl,i.type,e,a.value)})),this.applyState(),r&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}},{key:"remove",value:function(){this.gl.deleteProgram(this.program)}}]),t}();function q(t,e,i,r){r=r.length?function(t){var e=t.length,i=t[0].length;if(void 0===i)return t;var r=e*i,n=V[r];n||(V[r]=n=new Float32Array(r));for(var a=0;a<e;a++)n.set(t[a],a*i);return n}(r):r;var n=t.renderer.state.uniformLocations.get(i);if(r.length)if(void 0===n||n.length!==r.length)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(var i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}(n,r))return;n.set?n.set(r):function(t,e){for(var i=0,r=t.length;i<r;i++)t[i]=e[i]}(n,r),t.renderer.state.uniformLocations.set(i,n)}else{if(n===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function Y(t){for(var e=t.split("\n"),i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}var W=0;function H(t){W>100||(console.warn(t),++W>100&&console.warn("More than 100 program warnings - stopping logs."))}var Z=new I,Q=1,K=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.canvas,r=void 0===i?document.createElement("canvas"):i,a=e.width,s=void 0===a?300:a,o=e.height,h=void 0===o?150:o,u=e.dpr,l=void 0===u?1:u,c=e.alpha,d=void 0!==c&&c,f=e.depth,v=void 0===f||f,p=e.stencil,g=void 0!==p&&p,m=e.antialias,y=void 0!==m&&m,w=e.premultipliedAlpha,x=void 0!==w&&w,b=e.preserveDrawingBuffer,A=void 0!==b&&b,M=e.powerPreference,E=void 0===M?"default":M,k=e.autoClear,T=void 0===k||k,F=e.webgl,_=void 0===F?2:F;n(this,t);var R={alpha:d,depth:v,stencil:g,antialias:y,premultipliedAlpha:x,preserveDrawingBuffer:A,powerPreference:E};this.dpr=l,this.alpha=d,this.color=!0,this.depth=v,this.stencil=g,this.premultipliedAlpha=x,this.autoClear=T,this.id=Q++,2===_&&(this.gl=r.getContext("webgl2",R)),this.isWebgl2=!!this.gl,this.gl||(this.gl=r.getContext("webgl",R)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(s,h),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}return s(t,[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}},{key:"setViewport",value:function(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}},{key:"enable",value:function(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}},{key:"disable",value:function(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}},{key:"setBlendFunc",value:function(t,e,i,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=r,void 0!==i?this.gl.blendFuncSeparate(t,e,i,r):this.gl.blendFunc(t,e))}},{key:"setBlendEquation",value:function(t,e){t=t||this.gl.FUNC_ADD,this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}},{key:"setCullFace",value:function(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}},{key:"setFrontFace",value:function(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}},{key:"setDepthMask",value:function(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}},{key:"setDepthFunc",value:function(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}},{key:"activeTexture",value:function(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}},{key:"bindFramebuffer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.target,i=void 0===e?this.gl.FRAMEBUFFER:e,r=t.buffer,n=void 0===r?null:r;this.state.framebuffer!==n&&(this.state.framebuffer=n,this.gl.bindFramebuffer(i,n))}},{key:"getExtension",value:function(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}},{key:"sortOpaque",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}},{key:"sortTransparent",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}},{key:"sortUI",value:function(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}},{key:"getRenderList",value:function(t){var e=t.scene,i=t.camera,r=t.frustumCull,n=t.sort,a=[];if(i&&r&&i.updateFrustum(),e.traverse((function(t){if(!t.visible)return!0;t.draw&&(r&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||a.push(t))})),n){var s=[],o=[],h=[];a.forEach((function(t){t.program.transparent?t.program.depthTest?o.push(t):h.push(t):s.push(t),t.zDepth=0,0===t.renderOrder&&t.program.depthTest&&i&&(t.worldMatrix.getTranslation(Z),Z.applyMatrix4(i.projectionViewMatrix),t.zDepth=Z.z)})),s.sort(this.sortOpaque),o.sort(this.sortTransparent),h.sort(this.sortUI),a=s.concat(o,h)}return a}},{key:"render",value:function(t){var e=t.scene,i=t.camera,r=t.target,n=void 0===r?null:r,a=t.update,s=void 0===a||a,o=t.sort,h=void 0===o||o,u=t.frustumCull,l=void 0===u||u,c=t.clear;null===n?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(n),this.setViewport(n.width,n.height)),(c||this.autoClear&&!1!==c)&&(!this.depth||n&&!n.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&e.updateMatrixWorld(),i&&i.updateMatrixWorld(),this.getRenderList({scene:e,camera:i,frustumCull:l,sort:h}).forEach((function(t){t.draw({camera:i})}))}}]),t}();function $(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function J(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function tt(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=a*s,t}function et(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=i[0],h=i[1],u=i[2],l=i[3];return t[0]=r*l+s*o+n*u-a*h,t[1]=n*l+s*h+a*o-r*u,t[2]=a*l+s*u+r*h-n*o,t[3]=s*l-r*o-n*h-a*u,t}function it(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i*i+r*r+n*n+a*a,o=s?1/s:0;return t[0]=-i*o,t[1]=-r*o,t[2]=-n*o,t[3]=a*o,t}function rt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}var nt=$,at=J,st=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},ot=tt,ht=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n(this,i),(t=e.call(this,r,a,s,o)).onChange=function(){},v(t,f(t))}return s(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t,this.onChange()}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t,this.onChange()}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t,this.onChange()}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=t,this.onChange()}},{key:"identity",value:function(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}},{key:"set",value:function(t,e,i,r){return t.length?this.copy(t):(at(this,t,e,i,r),this.onChange(),this)}},{key:"rotateX",value:function(t){return function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=r*h+s*o,t[1]=n*h+a*o,t[2]=a*h-n*o,t[3]=s*h-r*o}(this,this,t),this.onChange(),this}},{key:"rotateY",value:function(t){return function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=r*h-a*o,t[1]=n*h+s*o,t[2]=a*h+r*o,t[3]=s*h-n*o}(this,this,t),this.onChange(),this}},{key:"rotateZ",value:function(t){return function(t,e,i){i*=.5;var r=e[0],n=e[1],a=e[2],s=e[3],o=Math.sin(i),h=Math.cos(i);t[0]=r*h+n*o,t[1]=n*h-r*o,t[2]=a*h+s*o,t[3]=s*h-a*o}(this,this,t),this.onChange(),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return it(this,t),this.onChange(),this}},{key:"conjugate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return rt(this,t),this.onChange(),this}},{key:"copy",value:function(t){return nt(this,t),this.onChange(),this}},{key:"normalize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return ot(this,t),this.onChange(),this}},{key:"multiply",value:function(t,e){return e?et(this,t,e):et(this,this,t),this.onChange(),this}},{key:"dot",value:function(t){return st(this,t)}},{key:"fromMatrix3",value:function(t){return function(t,e){var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,s=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*s+s]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*a+s]-e[3*s+a])*i,t[a]=(e[3*a+n]+e[3*n+a])*i,t[s]=(e[3*s+n]+e[3*n+s])*i}}(this,t),this.onChange(),this}},{key:"fromEuler",value:function(t){return function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ",r=Math.sin(.5*e[0]),n=Math.cos(.5*e[0]),a=Math.sin(.5*e[1]),s=Math.cos(.5*e[1]),o=Math.sin(.5*e[2]),h=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=r*s*h+n*a*o,t[1]=n*a*h-r*s*o,t[2]=n*s*o+r*a*h,t[3]=n*s*h-r*a*o):"YXZ"===i?(t[0]=r*s*h+n*a*o,t[1]=n*a*h-r*s*o,t[2]=n*s*o-r*a*h,t[3]=n*s*h+r*a*o):"ZXY"===i?(t[0]=r*s*h-n*a*o,t[1]=n*a*h+r*s*o,t[2]=n*s*o+r*a*h,t[3]=n*s*h-r*a*o):"ZYX"===i?(t[0]=r*s*h-n*a*o,t[1]=n*a*h+r*s*o,t[2]=n*s*o-r*a*h,t[3]=n*s*h+r*a*o):"YZX"===i?(t[0]=r*s*h+n*a*o,t[1]=n*a*h+r*s*o,t[2]=n*s*o-r*a*h,t[3]=n*s*h-r*a*o):"XZY"===i&&(t[0]=r*s*h-n*a*o,t[1]=n*a*h-r*s*o,t[2]=n*s*o+r*a*h,t[3]=n*s*h+r*a*o)}(this,t,t.order),this}},{key:"fromAxisAngle",value:function(t,e){return function(t,e,i){i*=.5;var r=Math.sin(i);t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i)}(this,t,e),this}},{key:"slerp",value:function(t,e){return function(t,e,i,r){var n,a,s,o,h,u=e[0],l=e[1],c=e[2],d=e[3],f=i[0],v=i[1],p=i[2],g=i[3];(a=u*f+l*v+c*p+d*g)<0&&(a=-a,f=-f,v=-v,p=-p,g=-g),1-a>1e-6?(n=Math.acos(a),s=Math.sin(n),o=Math.sin((1-r)*n)/s,h=Math.sin(r*n)/s):(o=1-r,h=r),t[0]=o*u+h*f,t[1]=o*l+h*v,t[2]=o*c+h*p,t[3]=o*d+h*g}(this,this,t,e),this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}]),i}(d(Array));function ut(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],f=e[11],v=e[12],p=e[13],g=e[14],m=e[15],y=i*o-r*s,w=i*h-n*s,x=i*u-a*s,b=r*h-n*o,A=r*u-a*o,M=n*u-a*h,E=l*p-c*v,k=l*g-d*v,T=l*m-f*v,F=c*g-d*p,_=c*m-f*p,R=d*m-f*g,S=y*R-w*_+x*F+b*T-A*k+M*E;return S?(S=1/S,t[0]=(o*R-h*_+u*F)*S,t[1]=(n*_-r*R-a*F)*S,t[2]=(p*M-g*A+m*b)*S,t[3]=(d*A-c*M-f*b)*S,t[4]=(h*T-s*R-u*k)*S,t[5]=(i*R-n*T+a*k)*S,t[6]=(g*x-v*M-m*w)*S,t[7]=(l*M-d*x+f*w)*S,t[8]=(s*_-o*T+u*E)*S,t[9]=(r*T-i*_-a*E)*S,t[10]=(v*A-p*x+m*y)*S,t[11]=(c*x-l*A-f*y)*S,t[12]=(o*k-s*F-h*E)*S,t[13]=(i*F-r*k+n*E)*S,t[14]=(p*w-v*b-g*y)*S,t[15]=(l*b-c*w+d*y)*S,t):null}function lt(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],f=e[10],v=e[11],p=e[12],g=e[13],m=e[14],y=e[15],w=i[0],x=i[1],b=i[2],A=i[3];return t[0]=w*r+x*o+b*c+A*p,t[1]=w*n+x*h+b*d+A*g,t[2]=w*a+x*u+b*f+A*m,t[3]=w*s+x*l+b*v+A*y,w=i[4],x=i[5],b=i[6],A=i[7],t[4]=w*r+x*o+b*c+A*p,t[5]=w*n+x*h+b*d+A*g,t[6]=w*a+x*u+b*f+A*m,t[7]=w*s+x*l+b*v+A*y,w=i[8],x=i[9],b=i[10],A=i[11],t[8]=w*r+x*o+b*c+A*p,t[9]=w*n+x*h+b*d+A*g,t[10]=w*a+x*u+b*f+A*m,t[11]=w*s+x*l+b*v+A*y,w=i[12],x=i[13],b=i[14],A=i[15],t[12]=w*r+x*o+b*c+A*p,t[13]=w*n+x*h+b*d+A*g,t[14]=w*a+x*u+b*f+A*m,t[15]=w*s+x*l+b*v+A*y,t}function ct(t,e,i){var r,n,a,s,o,h,u,l,c,d,f,v,p=i[0],g=i[1],m=i[2];return e===t?(t[12]=e[0]*p+e[4]*g+e[8]*m+e[12],t[13]=e[1]*p+e[5]*g+e[9]*m+e[13],t[14]=e[2]*p+e[6]*g+e[10]*m+e[14],t[15]=e[3]*p+e[7]*g+e[11]*m+e[15]):(r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],f=e[10],v=e[11],t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=u,t[7]=l,t[8]=c,t[9]=d,t[10]=f,t[11]=v,t[12]=r*p+o*g+c*m+e[12],t[13]=n*p+h*g+d*m+e[13],t[14]=a*p+u*g+f*m+e[14],t[15]=s*p+l*g+v*m+e[15]),t}function dt(t,e,i){var r=i[0],n=i[1],a=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ft(t,e,i,r){var n,a,s,o,h,u,l,c,d,f,v,p,g,m,y,w,x,b,A,M,E,k,T,F,_=r[0],R=r[1],S=r[2],P=Math.hypot(_,R,S);return Math.abs(P)<1e-6?null:(_*=P=1/P,R*=P,S*=P,n=Math.sin(i),s=1-(a=Math.cos(i)),o=e[0],h=e[1],u=e[2],l=e[3],c=e[4],d=e[5],f=e[6],v=e[7],p=e[8],g=e[9],m=e[10],y=e[11],w=_*_*s+a,x=R*_*s+S*n,b=S*_*s-R*n,A=_*R*s-S*n,M=R*R*s+a,E=S*R*s+_*n,k=_*S*s+R*n,T=R*S*s-_*n,F=S*S*s+a,t[0]=o*w+c*x+p*b,t[1]=h*w+d*x+g*b,t[2]=u*w+f*x+m*b,t[3]=l*w+v*x+y*b,t[4]=o*A+c*M+p*E,t[5]=h*A+d*M+g*E,t[6]=u*A+f*M+m*E,t[7]=l*A+v*M+y*E,t[8]=o*k+c*T+p*F,t[9]=h*k+d*T+g*F,t[10]=u*k+f*T+m*F,t[11]=l*k+v*T+y*F,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function vt(t,e){var i=e[0],r=e[1],n=e[2],a=e[4],s=e[5],o=e[6],h=e[8],u=e[9],l=e[10];return t[0]=Math.hypot(i,r,n),t[1]=Math.hypot(a,s,o),t[2]=Math.hypot(h,u,l),t}var pt,gt=(pt=[0,0,0],function(t,e){var i=pt;vt(i,e);var r=1/i[0],n=1/i[1],a=1/i[2],s=e[0]*r,o=e[1]*n,h=e[2]*a,u=e[4]*r,l=e[5]*n,c=e[6]*a,d=e[8]*r,f=e[9]*n,v=e[10]*a,p=s+l+v,g=0;return p>0?(g=2*Math.sqrt(p+1),t[3]=.25*g,t[0]=(c-f)/g,t[1]=(d-h)/g,t[2]=(o-u)/g):s>l&&s>v?(g=2*Math.sqrt(1+s-l-v),t[3]=(c-f)/g,t[0]=.25*g,t[1]=(o+u)/g,t[2]=(d+h)/g):l>v?(g=2*Math.sqrt(1+l-s-v),t[3]=(d-h)/g,t[0]=(o+u)/g,t[1]=.25*g,t[2]=(c+f)/g):(g=2*Math.sqrt(1+v-s-l),t[3]=(o-u)/g,t[0]=(d+h)/g,t[1]=(c+f)/g,t[2]=.25*g),t});function mt(t,e,i,r,n){var a=1/Math.tan(e/2),s=1/(r-n);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(n+r)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*n*r*s,t[15]=0,t}var yt=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,g=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,w=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,x=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,b=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;return n(this,i),v(t=e.call(this,r,a,s,o,h,u,l,c,d,p,g,m,y,w,x,b),f(t))}return s(i,[{key:"x",get:function(){return this[12]},set:function(t){this[12]=t}},{key:"y",get:function(){return this[13]},set:function(t){this[13]=t}},{key:"z",get:function(){return this[14]},set:function(t){this[14]=t}},{key:"w",get:function(){return this[15]},set:function(t){this[15]=t}},{key:"set",value:function(t,e,i,r,n,a,s,o,h,u,l,c,d,f,v,p){return t.length?this.copy(t):(function(t,e,i,r,n,a,s,o,h,u,l,c,d,f,v,p,g){t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u,t[9]=l,t[10]=c,t[11]=d,t[12]=f,t[13]=v,t[14]=p,t[15]=g}(this,t,e,i,r,n,a,s,o,h,u,l,c,d,f,v,p),this)}},{key:"translate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return ct(this,e,t),this}},{key:"rotate",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;return ft(this,i,t,e),this}},{key:"scale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return dt(this,e,"number"==typeof t?[t,t,t]:t),this}},{key:"multiply",value:function(t,e){return e?lt(this,t,e):lt(this,this,t),this}},{key:"identity",value:function(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}},{key:"fromPerspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fov,i=t.aspect,r=t.near,n=t.far;return mt(this,e,i,r,n),this}},{key:"fromOrthogonal",value:function(t){return function(t,e,i,r,n,a,s){var o=1/(e-i),h=1/(r-n),u=1/(a-s);t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+i)*o,t[13]=(n+r)*h,t[14]=(s+a)*u,t[15]=1}(this,t.left,t.right,t.bottom,t.top,t.near,t.far),this}},{key:"fromQuaternion",value:function(t){return function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,h=n+n,u=i*s,l=r*s,c=r*o,d=n*s,f=n*o,v=n*h,p=a*s,g=a*o,m=a*h;t[0]=1-c-v,t[1]=l+m,t[2]=d-g,t[3]=0,t[4]=l-m,t[5]=1-u-v,t[6]=f+p,t[7]=0,t[8]=d+g,t[9]=f-p,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}},{key:"setPosition",value:function(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return ut(this,t),this}},{key:"compose",value:function(t,e,i){return function(t,e,i,r){var n=e[0],a=e[1],s=e[2],o=e[3],h=n+n,u=a+a,l=s+s,c=n*h,d=n*u,f=n*l,v=a*u,p=a*l,g=s*l,m=o*h,y=o*u,w=o*l,x=r[0],b=r[1],A=r[2];t[0]=(1-(v+g))*x,t[1]=(d+w)*x,t[2]=(f-y)*x,t[3]=0,t[4]=(d-w)*b,t[5]=(1-(c+g))*b,t[6]=(p+m)*b,t[7]=0,t[8]=(f+y)*A,t[9]=(p-m)*A,t[10]=(1-(c+v))*A,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1}(this,t,e,i),this}},{key:"getRotation",value:function(t){return gt(t,this),this}},{key:"getTranslation",value:function(t){var e,i;return i=this,(e=t)[0]=i[12],e[1]=i[13],e[2]=i[14],this}},{key:"getScaling",value:function(t){return vt(t,this),this}},{key:"getMaxScaleOnAxis",value:function(){return e=(t=this)[0],i=t[1],r=t[2],n=t[4],a=t[5],s=t[6],o=t[8],h=t[9],u=t[10],l=e*e+i*i+r*r,c=n*n+a*a+s*s,d=o*o+h*h+u*u,Math.sqrt(Math.max(l,c,d));var t,e,i,r,n,a,s,o,h,u,l,c,d}},{key:"lookAt",value:function(t,e,i){return function(t,e,i,r){var n=e[0],a=e[1],s=e[2],o=r[0],h=r[1],u=r[2],l=n-i[0],c=a-i[1],d=s-i[2],f=l*l+c*c+d*d;0===f?d=1:(l*=f=1/Math.sqrt(f),c*=f,d*=f);var v=h*d-u*c,p=u*l-o*d,g=o*c-h*l;0==(f=v*v+p*p+g*g)&&(u?o+=1e-6:h?u+=1e-6:h+=1e-6,f=(v=h*d-u*c)*v+(p=u*l-o*d)*p+(g=o*c-h*l)*g),v*=f=1/Math.sqrt(f),p*=f,g*=f,t[0]=v,t[1]=p,t[2]=g,t[3]=0,t[4]=c*g-d*p,t[5]=d*v-l*g,t[6]=l*p-c*v,t[7]=0,t[8]=l,t[9]=c,t[10]=d,t[11]=0,t[12]=n,t[13]=a,t[14]=s,t[15]=1}(this,t,e,i),this}},{key:"determinant",value:function(){return e=(t=this)[0],i=t[1],r=t[2],n=t[3],a=t[4],s=t[5],o=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],f=t[12],v=t[13],p=t[14],g=t[15],(e*s-i*a)*(c*g-d*p)-(e*o-r*a)*(l*g-d*v)+(e*h-n*a)*(l*p-c*v)+(i*o-r*s)*(u*g-d*f)-(i*h-n*s)*(u*p-c*f)+(r*h-n*o)*(u*v-l*f);var t,e,i,r,n,a,s,o,h,u,l,c,d,f,v,p,g}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}}]),i}(d(Array));function wt(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ";return"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0)),t}var xt=new yt,bt=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"YXZ";return n(this,i),(t=e.call(this,r,a,s)).order=o,t.onChange=function(){},v(t,f(t))}return s(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t,this.onChange()}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t,this.onChange()}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t,this.onChange()}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}},{key:"reorder",value:function(t){return this.order=t,this.onChange(),this}},{key:"fromRotationMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return wt(this,t,e),this}},{key:"fromQuaternion",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return xt.fromQuaternion(t),this.fromRotationMatrix(xt,e)}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}}]),i}(d(Array)),At=function(){function t(){var e=this;n(this,t),this.parent=null,this.children=[],this.visible=!0,this.matrix=new yt,this.worldMatrix=new yt,this.matrixAutoUpdate=!0,this.position=new I,this.quaternion=new ht,this.scale=new I(1),this.rotation=new bt,this.up=new I(0,1,0),this.rotation.onChange=function(){return e.quaternion.fromEuler(e.rotation)},this.quaternion.onChange=function(){return e.rotation.fromQuaternion(e.quaternion)}}return s(t,[{key:"setParent",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}},{key:"addChild",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}},{key:"removeChild",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}},{key:"updateMatrixWorld",value:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}},{key:"updateMatrix",value:function(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}},{key:"traverse",value:function(t){if(!t(this))for(var e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}},{key:"decompose",value:function(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}},{key:"lookAt",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}]),t}(),Mt=new yt,Et=new I,kt=new I,Tt=function(t){o(i,t);var e=p(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.near,o=void 0===s?.1:s,h=a.far,u=void 0===h?100:h,l=a.fov,c=void 0===l?45:l,d=a.aspect,v=void 0===d?1:d,p=a.left,g=a.right,m=a.bottom,y=a.top,w=a.zoom,x=void 0===w?1:w;return n(this,i),r=e.call(this),Object.assign(f(r),{near:o,far:u,fov:c,aspect:v,left:p,right:g,bottom:m,top:y,zoom:x}),r.projectionMatrix=new yt,r.viewMatrix=new yt,r.projectionViewMatrix=new yt,r.worldPosition=new I,r.type=p||g?"orthographic":"perspective","orthographic"===r.type?r.orthographic():r.perspective(),r}return s(i,[{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.near,i=void 0===e?this.near:e,r=t.far,n=void 0===r?this.far:r,a=t.fov,s=void 0===a?this.fov:a,o=t.aspect,h=void 0===o?this.aspect:o;return Object.assign(this,{near:i,far:n,fov:s,aspect:h}),this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:h,near:i,far:n}),this.type="perspective",this}},{key:"orthographic",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.near,i=void 0===e?this.near:e,r=t.far,n=void 0===r?this.far:r,a=t.left,s=void 0===a?this.left:a,o=t.right,h=void 0===o?this.right:o,u=t.bottom,l=void 0===u?this.bottom:u,c=t.top,d=void 0===c?this.top:c,f=t.zoom,v=void 0===f?this.zoom:f;return Object.assign(this,{near:i,far:n,left:s,right:h,bottom:l,top:d,zoom:v}),s/=v,h/=v,l/=v,d/=v,this.projectionMatrix.fromOrthogonal({left:s,right:h,bottom:l,top:d,near:i,far:n}),this.type="orthographic",this}},{key:"updateMatrixWorld",value:function(){return g(h(i.prototype),"updateMatrixWorld",this).call(this),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}},{key:"lookAt",value:function(t){return g(h(i.prototype),"lookAt",this).call(this,t,!0),this}},{key:"project",value:function(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}},{key:"unproject",value:function(t){return t.applyMatrix4(Mt.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}},{key:"updateFrustum",value:function(){this.frustum||(this.frustum=[new I,new I,new I,new I,new I,new I]);var t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(var e=0;e<6;e++){var i=1/this.frustum[e].distance();this.frustum[e].multiply(i),this.frustum[e].constant*=i}}},{key:"frustumIntersectsMesh",value:function(t){if(!t.geometry.attributes.position)return!0;if(t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere(),!t.geometry.bounds)return!0;var e=Et;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);var i=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,i)}},{key:"frustumIntersectsSphere",value:function(t,e){for(var i=kt,r=0;r<6;r++){var n=this.frustum[r];if(i.copy(n).dot(t)+n.constant<-e)return!1}return!0}}]),i}(At);function Ft(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],h=e[6],u=e[7],l=e[8],c=l*s-o*u,d=-l*a+o*h,f=u*a-s*h,v=i*c+r*d+n*f;return v?(v=1/v,t[0]=c*v,t[1]=(-l*r+n*u)*v,t[2]=(o*r-n*s)*v,t[3]=d*v,t[4]=(l*i-n*h)*v,t[5]=(-o*i+n*a)*v,t[6]=f*v,t[7]=(-u*i+r*h)*v,t[8]=(s*i-r*a)*v,t):null}function _t(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=i[0],f=i[1],v=i[2],p=i[3],g=i[4],m=i[5],y=i[6],w=i[7],x=i[8];return t[0]=d*r+f*s+v*u,t[1]=d*n+f*o+v*l,t[2]=d*a+f*h+v*c,t[3]=p*r+g*s+m*u,t[4]=p*n+g*o+m*l,t[5]=p*a+g*h+m*c,t[6]=y*r+w*s+x*u,t[7]=y*n+w*o+x*l,t[8]=y*a+w*h+x*c,t}function Rt(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=i[0],f=i[1];return t[0]=r,t[1]=n,t[2]=a,t[3]=s,t[4]=o,t[5]=h,t[6]=d*r+f*s+u,t[7]=d*n+f*o+l,t[8]=d*a+f*h+c,t}function St(t,e,i){var r=e[0],n=e[1],a=e[2],s=e[3],o=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=Math.sin(i),f=Math.cos(i);return t[0]=f*r+d*s,t[1]=f*n+d*o,t[2]=f*a+d*h,t[3]=f*s-d*r,t[4]=f*o-d*n,t[5]=f*h-d*a,t[6]=u,t[7]=l,t[8]=c,t}function Pt(t,e,i){var r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}var Lt=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,d=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1;return n(this,i),v(t=e.call(this,r,a,s,o,h,u,l,c,d),f(t))}return s(i,[{key:"set",value:function(t,e,i,r,n,a,s,o,h){return t.length?this.copy(t):(function(t,e,i,r,n,a,s,o,h,u){t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=a,t[5]=s,t[6]=o,t[7]=h,t[8]=u}(this,t,e,i,r,n,a,s,o,h),this)}},{key:"translate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return Rt(this,e,t),this}},{key:"rotate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return St(this,e,t),this}},{key:"scale",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;return Pt(this,e,t),this}},{key:"multiply",value:function(t,e){return e?_t(this,t,e):_t(this,this,t),this}},{key:"identity",value:function(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}},{key:"fromMatrix4",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this}},{key:"fromQuaternion",value:function(t){return function(t,e){var i=e[0],r=e[1],n=e[2],a=e[3],s=i+i,o=r+r,h=n+n,u=i*s,l=r*s,c=r*o,d=n*s,f=n*o,v=n*h,p=a*s,g=a*o,m=a*h;t[0]=1-c-v,t[3]=l-m,t[6]=d+g,t[1]=l+m,t[4]=1-u-v,t[7]=f-p,t[2]=d-g,t[5]=f+p,t[8]=1-u-c}(this,t),this}},{key:"fromBasis",value:function(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return Ft(this,t),this}},{key:"getNormalMatrix",value:function(t){var e,i,r,n,a,s,o,h,u,l,c,d,f,v,p,g,m,y,w,x,b,A,M,E,k,T,F,_,R,S,P;return e=this,r=(i=t)[0],n=i[1],a=i[2],s=i[3],o=i[4],h=i[5],u=i[6],l=i[7],c=i[8],d=i[9],f=i[10],v=i[11],p=i[12],g=i[13],m=i[14],y=i[15],(P=(w=r*h-n*o)*(S=f*y-v*m)-(x=r*u-a*o)*(R=d*y-v*g)+(b=r*l-s*o)*(_=d*m-f*g)+(A=n*u-a*h)*(F=c*y-v*p)-(M=n*l-s*h)*(T=c*m-f*p)+(E=a*l-s*u)*(k=c*g-d*p))&&(P=1/P,e[0]=(h*S-u*R+l*_)*P,e[1]=(u*F-o*S-l*T)*P,e[2]=(o*R-h*F+l*k)*P,e[3]=(a*R-n*S-s*_)*P,e[4]=(r*S-a*F+s*T)*P,e[5]=(n*F-r*R-s*k)*P,e[6]=(g*E-m*M+y*A)*P,e[7]=(m*b-p*E-y*x)*P,e[8]=(p*M-g*b+y*w)*P),this}}]),i}(d(Array)),Ot=0,Ct=function(t){o(i,t);var e=p(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.geometry,o=a.program,h=a.mode,u=void 0===h?t.TRIANGLES:h,l=a.frustumCulled,c=void 0===l||l,d=a.renderOrder,f=void 0===d?0:d;return n(this,i),r=e.call(this),t.canvas||console.error("gl not passed as first argument to Mesh"),r.gl=t,r.id=Ot++,r.geometry=s,r.program=o,r.mode=u,r.frustumCulled=c,r.renderOrder=f,r.modelViewMatrix=new yt,r.normalMatrix=new Lt,r.beforeRenderCallbacks=[],r.afterRenderCallbacks=[],r}return s(i,[{key:"onBeforeRender",value:function(t){return this.beforeRenderCallbacks.push(t),this}},{key:"onAfterRender",value:function(t){return this.afterRenderCallbacks.push(t),this}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.camera;this.beforeRenderCallbacks.forEach((function(e){return e&&e({mesh:t,camera:i})})),i&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=i.projectionMatrix,this.program.uniforms.cameraPosition.value=i.worldPosition,this.program.uniforms.viewMatrix.value=i.viewMatrix,this.modelViewMatrix.multiply(i.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);var r=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:r}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((function(e){return e&&e({mesh:t,camera:i})}))}}]),i}(At),Bt=new Uint8Array(4);function It(t){return 0==(t&t-1)}var Ut=1,Nt=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.image,a=i.target,s=void 0===a?e.TEXTURE_2D:a,o=i.type,h=void 0===o?e.UNSIGNED_BYTE:o,u=i.format,l=void 0===u?e.RGBA:u,c=i.internalFormat,d=void 0===c?l:c,f=i.wrapS,v=void 0===f?e.CLAMP_TO_EDGE:f,p=i.wrapT,g=void 0===p?e.CLAMP_TO_EDGE:p,m=i.generateMipmaps,y=void 0===m||m,w=i.minFilter,x=void 0===w?y?e.NEAREST_MIPMAP_LINEAR:e.LINEAR:w,b=i.magFilter,A=void 0===b?e.LINEAR:b,M=i.premultiplyAlpha,E=void 0!==M&&M,k=i.unpackAlignment,T=void 0===k?4:k,F=i.flipY,_=void 0===F?s==e.TEXTURE_2D:F,R=i.anisotropy,S=void 0===R?0:R,P=i.level,L=void 0===P?0:P,O=i.width,C=i.height,B=void 0===C?O:C;n(this,t),this.gl=e,this.id=Ut++,this.image=r,this.target=s,this.type=h,this.format=l,this.internalFormat=d,this.minFilter=x,this.magFilter=A,this.wrapS=v,this.wrapT=g,this.generateMipmaps=y,this.premultiplyAlpha=E,this.unpackAlignment=T,this.flipY=_,this.anisotropy=Math.min(S,this.gl.renderer.parameters.maxAnisotropy),this.level=L,this.width=O,this.height=B,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}return s(t,[{key:"bind",value:function(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(var i=0;i<6;i++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,this.level,this.internalFormat,this.format,this.type,this.image[i]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(var r=0;r<this.image.length;r++)this.gl.compressedTexImage2D(this.target,r,this.internalFormat,this.image[r].width,this.image[r].height,0,this.image[r].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||It(this.image.width)&&It(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(var n=0;n<6;n++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Bt);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,Bt);this.store.image=this.image}}}]),t}(),zt=function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.width,a=void 0===r?e.canvas.width:r,s=i.height,o=void 0===s?e.canvas.height:s,h=i.target,u=void 0===h?e.FRAMEBUFFER:h,l=i.color,c=void 0===l?1:l,d=i.depth,f=void 0===d||d,v=i.stencil,p=void 0!==v&&v,g=i.depthTexture,m=void 0!==g&&g,y=i.wrapS,w=void 0===y?e.CLAMP_TO_EDGE:y,x=i.wrapT,b=void 0===x?e.CLAMP_TO_EDGE:x,A=i.minFilter,M=void 0===A?e.LINEAR:A,E=i.magFilter,k=void 0===E?M:E,T=i.type,F=void 0===T?e.UNSIGNED_BYTE:T,_=i.format,R=void 0===_?e.RGBA:_,S=i.internalFormat,P=void 0===S?R:S,L=i.unpackAlignment,O=i.premultiplyAlpha;n(this,t),this.gl=e,this.width=a,this.height=o,this.depth=f,this.buffer=this.gl.createFramebuffer(),this.target=u,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];for(var C=[],B=0;B<c;B++)this.textures.push(new Nt(e,{width:a,height:o,wrapS:w,wrapT:b,minFilter:M,magFilter:k,type:F,format:R,internalFormat:P,unpackAlignment:L,premultiplyAlpha:O,flipY:!1,generateMipmaps:!1})),this.textures[B].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+B,this.gl.TEXTURE_2D,this.textures[B].texture,0),C.push(this.gl.COLOR_ATTACHMENT0+B);C.length>1&&this.gl.renderer.drawBuffers(C),this.texture=this.textures[0],m&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new Nt(e,{width:a,height:o,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:e.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(f&&!p&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,a,o),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),p&&!f&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,a,o),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),f&&p&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,a,o),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)},Dt={black:"#000000",white:"#ffffff",red:"#ff0000",green:"#00ff00",blue:"#0000ff",fuchsia:"#ff00ff",cyan:"#00ffff",yellow:"#ffff00",orange:"#ff8000"};function Gt(t){4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn("Unable to convert hex string ".concat(t," to rgb values")),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}function jt(t){return[((t=parseInt(t))>>16&255)/255,(t>>8&255)/255,(255&t)/255]}function Vt(t){return void 0===t?[0,0,0]:3===arguments.length?arguments:isNaN(t)?"#"===t[0]?Gt(t):Dt[t.toLowerCase()]?Gt(Dt[t.toLowerCase()]):(console.warn("Color format not recognised"),[0,0,0]):jt(t)}var Xt=Object.freeze({__proto__:null,hexToRGB:Gt,numberToRGB:jt,parseColor:Vt}),qt=function(t){o(i,t);var e=p(i);function i(t){var r;return n(this,i),Array.isArray(t)?v(r,r=e.call.apply(e,[this].concat(y(t)))):v(r,r=e.call.apply(e,[this].concat(y(Vt.apply(Xt,arguments)))))}return s(i,[{key:"r",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"g",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"b",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"set",value:function(t){return Array.isArray(t)?this.copy(t):this.copy(Vt.apply(Xt,arguments))}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}}]),i}(d(Array));function Yt(t,e,i){return t[0]=e,t[1]=i,t}function Wt(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Ht(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function Zt(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function Qt(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function Kt(t,e){return t[0]=-e[0],t[1]=-e[1],t}function $t(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Jt(t,e){return t[0]*e[1]-t[1]*e[0]}var te=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;return n(this,i),v(t=e.call(this,r,a),f(t))}return s(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return t.length?this.copy(t):(Yt(this,t,e),this)}},{key:"copy",value:function(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}},{key:"add",value:function(t,e){return e?Wt(this,t,e):Wt(this,this,t),this}},{key:"sub",value:function(t,e){return e?Ht(this,t,e):Ht(this,this,t),this}},{key:"multiply",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1]):Zt(this,this,t),this}},{key:"divide",value:function(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1]):Zt(this,this,1/t),this}},{key:"inverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return $t(this,t),this}},{key:"len",value:function(){return Qt(this)}},{key:"distance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],Math.sqrt(r*r+n*n)):Qt(this);var e,i,r,n}},{key:"squaredLen",value:function(){return this.squaredDistance()}},{key:"squaredDistance",value:function(t){return t?(e=this,r=(i=t)[0]-e[0],n=i[1]-e[1],r*r+n*n):function(t){var e=t[0],i=t[1];return e*e+i*i}(this);var e,i,r,n}},{key:"negate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return Kt(this,t),this}},{key:"cross",value:function(t,e){return e?Jt(t,e):Jt(this,t)}},{key:"scale",value:function(t){return Zt(this,this,t),this}},{key:"normalize",value:function(){var t,e,i,r,n;return t=this,i=(e=this)[0],r=e[1],(n=i*i+r*r)>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,this}},{key:"dot",value:function(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}},{key:"equals",value:function(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}},{key:"applyMatrix3",value:function(t){var e,i,r,n,a;return e=this,r=t,n=(i=this)[0],a=i[1],e[0]=r[0]*n+r[3]*a+r[6],e[1]=r[1]*n+r[4]*a+r[7],this}},{key:"applyMatrix4",value:function(t){var e,i,r,n,a;return e=this,r=t,n=(i=this)[0],a=i[1],e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],this}},{key:"lerp",value:function(t,e){return function(t,e,i,r){var n=e[0],a=e[1];t[0]=n+r*(i[0]-n),t[1]=a+r*(i[1]-a)}(this,this,t,e),this}},{key:"clone",value:function(){return new i(this[0],this[1])}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t}}]),i}(d(Array)),ee=function(t){o(i,t);var e=p(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;return n(this,i),v(t=e.call(this,r,a,s,o),f(t))}return s(i,[{key:"x",get:function(){return this[0]},set:function(t){this[0]=t}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=t}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=t}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=t}},{key:"set",value:function(t,e,i,r){return t.length?this.copy(t):(J(this,t,e,i,r),this)}},{key:"copy",value:function(t){return $(this,t),this}},{key:"normalize",value:function(){return tt(this,this),this}},{key:"fromArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}},{key:"toArray",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}]),i}(d(Array)),ie=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.width,s=void 0===a?1:a,o=r.height,h=void 0===o?1:o,u=r.widthSegments,l=void 0===u?1:u,c=r.heightSegments,d=void 0===c?1:c,f=r.attributes,v=void 0===f?{}:f;n(this,i);var p=l,g=d,m=(p+1)*(g+1),y=p*g*6,w=new Float32Array(3*m),x=new Float32Array(3*m),b=new Float32Array(2*m),A=y>65536?new Uint32Array(y):new Uint16Array(y);return i.buildPlane(w,x,b,A,s,h,0,p,g),Object.assign(v,{position:{size:3,data:w},normal:{size:3,data:x},uv:{size:2,data:b},index:{data:A}}),e.call(this,t,v)}return s(i,null,[{key:"buildPlane",value:function(t,e,i,r,n,a,s,o,h){for(var u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,l=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:2,d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:-1,v=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0,g=v,m=n/o,y=a/h,w=0;w<=h;w++)for(var x=w*y-a/2,b=0;b<=o;b++,v++){var A=b*m-n/2;if(t[3*v+u]=A*d,t[3*v+l]=x*f,t[3*v+c]=s/2,e[3*v+u]=0,e[3*v+l]=0,e[3*v+c]=s>=0?1:-1,i[2*v]=b/o,i[2*v+1]=1-w/h,w!==h&&b!==o){var M=g+b+w*(o+1),E=g+b+(w+1)*(o+1),k=g+b+(w+1)*(o+1)+1,T=g+b+w*(o+1)+1;r[6*p]=M,r[6*p+1]=E,r[6*p+2]=T,r[6*p+3]=E,r[6*p+4]=k,r[6*p+5]=T,p++}}}}]),i}(G),re=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.width,s=void 0===a?1:a,o=r.height,h=void 0===o?1:o,u=r.depth,l=void 0===u?1:u,c=r.widthSegments,d=void 0===c?1:c,f=r.heightSegments,v=void 0===f?1:f,p=r.depthSegments,g=void 0===p?1:p,m=r.attributes,y=void 0===m?{}:m;n(this,i);var w=d,x=v,b=g,A=(w+1)*(x+1)*2+(w+1)*(b+1)*2+(x+1)*(b+1)*2,M=6*(w*x*2+w*b*2+x*b*2),E=new Float32Array(3*A),k=new Float32Array(3*A),T=new Float32Array(2*A),F=A>65536?new Uint32Array(M):new Uint16Array(M),_=0,R=0;return ie.buildPlane(E,k,T,F,l,h,s,b,x,2,1,0,-1,-1,_,R),_+=(b+1)*(x+1),R+=b*x,ie.buildPlane(E,k,T,F,l,h,-s,b,x,2,1,0,1,-1,_,R),_+=(b+1)*(x+1),R+=b*x,ie.buildPlane(E,k,T,F,s,l,h,b,w,0,2,1,1,1,_,R),_+=(w+1)*(b+1),R+=w*b,ie.buildPlane(E,k,T,F,s,l,-h,b,w,0,2,1,1,-1,_,R),_+=(w+1)*(b+1),R+=w*b,ie.buildPlane(E,k,T,F,s,h,-l,w,x,0,1,2,-1,-1,_,R),_+=(w+1)*(x+1),R+=w*x,ie.buildPlane(E,k,T,F,s,h,l,w,x,0,1,2,1,-1,_,R),Object.assign(y,{position:{size:3,data:E},normal:{size:3,data:k},uv:{size:2,data:T},index:{data:F}}),e.call(this,t,y)}return i}(G),ne=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.radius,s=void 0===a?.5:a,o=r.widthSegments,h=void 0===o?16:o,u=r.heightSegments,l=void 0===u?Math.ceil(.5*h):u,c=r.phiStart,d=void 0===c?0:c,f=r.phiLength,v=void 0===f?2*Math.PI:f,p=r.thetaStart,g=void 0===p?0:p,m=r.thetaLength,y=void 0===m?Math.PI:m,w=r.attributes,x=void 0===w?{}:w;n(this,i);for(var b=h,A=l,M=d,E=v,k=g,T=y,F=(b+1)*(A+1),_=b*A*6,R=new Float32Array(3*F),S=new Float32Array(3*F),P=new Float32Array(2*F),L=F>65536?new Uint32Array(_):new Uint16Array(_),O=0,C=0,B=0,U=k+T,N=[],z=new I,D=0;D<=A;D++){for(var G=[],j=D/A,V=0;V<=b;V++,O++){var X=V/b,q=-s*Math.cos(M+X*E)*Math.sin(k+j*T),Y=s*Math.cos(k+j*T),W=s*Math.sin(M+X*E)*Math.sin(k+j*T);R[3*O]=q,R[3*O+1]=Y,R[3*O+2]=W,z.set(q,Y,W).normalize(),S[3*O]=z.x,S[3*O+1]=z.y,S[3*O+2]=z.z,P[2*O]=X,P[2*O+1]=1-j,G.push(C++)}N.push(G)}for(var H=0;H<A;H++)for(var Z=0;Z<b;Z++){var Q=N[H][Z+1],K=N[H][Z],$=N[H+1][Z],J=N[H+1][Z+1];(0!==H||k>0)&&(L[3*B]=Q,L[3*B+1]=K,L[3*B+2]=J,B++),(H!==A-1||U<Math.PI)&&(L[3*B]=K,L[3*B+1]=$,L[3*B+2]=J,B++)}return Object.assign(x,{position:{size:3,data:R},normal:{size:3,data:S},uv:{size:2,data:P},index:{data:L}}),e.call(this,t,x)}return i}(G),ae=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.radiusTop,s=void 0===a?.5:a,o=r.radiusBottom,h=void 0===o?.5:o,u=r.height,l=void 0===u?1:u,c=r.radialSegments,d=void 0===c?8:c,f=r.heightSegments,v=void 0===f?1:f,p=r.openEnded,g=void 0!==p&&p,m=r.thetaStart,y=void 0===m?0:m,w=r.thetaLength,x=void 0===w?2*Math.PI:w,b=r.attributes,A=void 0===b?{}:b;n(this,i);var M=d,E=v,k=y,T=x,F=g?0:h&&s?2:1,_=(M+1)*(E+1+F)+F,R=M*E*6+F*M*3,S=new Float32Array(3*_),P=new Float32Array(3*_),L=new Float32Array(2*_),O=_>65536?new Uint32Array(R):new Uint16Array(R),C=0,B=0,U=[];function N(){var t,e,i=new I,r=(h-s)/l;for(e=0;e<=E;e++){var n=[],a=e/E,o=a*(h-s)+s;for(t=0;t<=M;t++){var u=t/M,c=u*T+k,d=Math.sin(c),f=Math.cos(c);S.set([o*d,(.5-a)*l,o*f],3*C),i.set(d,r,f).normalize(),P.set([i.x,i.y,i.z],3*C),L.set([u,1-a],2*C),n.push(C++)}U.push(n)}for(t=0;t<M;t++)for(e=0;e<E;e++){var v=U[e][t],p=U[e+1][t],g=U[e+1][t+1],m=U[e][t+1];O.set([v,p,m,p,g,m],3*B),B+=2}}function z(t){var e,i=!0===t?s:h,r=!0===t?1:-1,n=C;for(S.set([0,.5*l*r,0],3*C),P.set([0,r,0],3*C),L.set([.5,.5],2*C),C++,e=0;e<=M;e++){var a=e/M*T+k,o=Math.cos(a),u=Math.sin(a);S.set([i*u,.5*l*r,i*o],3*C),P.set([0,r,0],3*C),L.set([.5*o+.5,.5*u*r+.5],2*C),C++}for(e=0;e<M;e++){var c=n+e+1;t?O.set([c,c+1,n],3*B):O.set([c+1,c,n],3*B),B++}}return N(),g||(s&&z(!0),h&&z(!1)),Object.assign(A,{position:{size:3,data:S},normal:{size:3,data:P},uv:{size:2,data:L},index:{data:O}}),e.call(this,t,A)}return i}(G),se=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.attributes,s=void 0===a?{}:a;return n(this,i),Object.assign(s,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),e.call(this,t,s)}return i}(G),oe=function(t){o(i,t);var e=p(i);function i(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r.radius,s=void 0===a?.5:a,o=r.tube,h=void 0===o?.2:o,u=r.radialSegments,l=void 0===u?8:u,c=r.tubularSegments,d=void 0===c?6:c,f=r.arc,v=void 0===f?2*Math.PI:f,p=r.attributes,g=void 0===p?{}:p;n(this,i);for(var m=(l+1)*(d+1),y=l*d*6,w=new Float32Array(3*m),x=new Float32Array(3*m),b=new Float32Array(2*m),A=m>65536?new Uint32Array(y):new Uint16Array(y),M=new I,E=new I,k=new I,T=0,F=0;F<=l;F++)for(var _=0;_<=d;_++,T++){var R=_/d*v,S=F/l*Math.PI*2;E.x=(s+h*Math.cos(S))*Math.cos(R),E.y=(s+h*Math.cos(S))*Math.sin(R),E.z=h*Math.sin(S),w.set([E.x,E.y,E.z],3*T),M.x=s*Math.cos(R),M.y=s*Math.sin(R),k.sub(E,M).normalize(),x.set([k.x,k.y,k.z],3*T),b.set([_/d,F/l],2*T)}T=0;for(var P=1;P<=l;P++)for(var L=1;L<=d;L++,T++){var O=(d+1)*P+L-1,C=(d+1)*(P-1)+L-1,B=(d+1)*(P-1)+L,U=(d+1)*P+L;A.set([O,C,U,C,B,U],6*T)}return Object.assign(g,{position:{size:3,data:w},normal:{size:3,data:x},uv:{size:2,data:b},index:{data:A}}),e.call(this,t,g)}return i}(G),he=-1,ue=0,le=1,ce=2,de=3,fe=new I,ve=new te,pe=new te;var ge=new te,me=new te,ye=new te,we=new I,xe=new I,be=new I,Ae=new I,Me=new I,Ee=new I,ke=new I,Te=new I,Fe=new I,_e=new I,Re=new I,Se=new yt,Pe=function(){function t(){n(this,t),this.origin=new I,this.direction=new I}return s(t,[{key:"castMouse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];if("orthographic"===t.type){var i=t.left,r=t.right,n=t.bottom,a=t.top,s=t.zoom,o=i/s+(r-i)/s*(.5*e[0]+.5),h=n/s+(a-n)/s*(.5*e[1]+.5);this.origin.set(o,h,0),this.origin.applyMatrix4(t.worldMatrix),this.direction.x=-t.worldMatrix[8],this.direction.y=-t.worldMatrix[9],this.direction.z=-t.worldMatrix[10]}else t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}},{key:"intersectBounds",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.maxDistance,n=i.output,a=void 0===n?[]:n;Array.isArray(t)||(t=[t]);var s=Se,o=we,h=xe,u=a;return u.length=0,t.forEach((function(t){t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();var i,n=t.geometry.bounds;if(s.inverse(t.worldMatrix),r&&(h.copy(e.direction).scaleRotateMatrix4(s),i=r*h.len()),o.copy(e.origin).applyMatrix4(s),h.copy(e.direction).transformDirection(s),!(r&&o.distance(n.center)-n.radius>i)){var a=0;if("sphere"===t.geometry.raycast){if(o.distance(n.center)>n.radius&&!(a=e.intersectSphere(n,o,h)))return}else if((o.x<n.min.x||o.x>n.max.x||o.y<n.min.y||o.y>n.max.y||o.z<n.min.z||o.z>n.max.z)&&!(a=e.intersectBox(n,o,h)))return;r&&a>i||(t.hit||(t.hit={localPoint:new I,point:new I}),t.hit.localPoint.copy(h).multiply(a).add(o),t.hit.point.copy(t.hit.localPoint).applyMatrix4(t.worldMatrix),t.hit.distance=t.hit.point.distance(e.origin),u.push(t))}})),u.sort((function(t,e){return t.hit.distance-e.hit.distance})),u}},{key:"intersectMeshes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.cullFace,r=void 0===i||i,n=e.maxDistance,a=e.includeUV,s=void 0===a||a,o=e.includeNormal,h=void 0===o||o,u=e.output,l=void 0===u?[]:u,c=this.intersectBounds(t,{maxDistance:n,output:l});if(!c.length)return c;for(var d=Se,f=we,v=xe,p=be,g=Ae,m=Me,y=Ee,w=ke,x=Te,b=ge,A=me,M=ye,E=c.length-1;E>=0;E--){var k=c[E];d.inverse(k.worldMatrix);var T=void 0;n&&(v.copy(this.direction).scaleRotateMatrix4(d),T=n*v.len()),f.copy(this.origin).applyMatrix4(d),v.copy(this.direction).transformDirection(d);for(var F=0,_=void 0,R=void 0,S=void 0,P=k.geometry,L=P.attributes,O=L.index,C=Math.max(0,P.drawRange.start),B=Math.min(O?O.count:L.position.count,P.drawRange.start+P.drawRange.count),U=C;U<B;U+=3){var N=O?O.data[U]:U,z=O?O.data[U+1]:U+1,D=O?O.data[U+2]:U+2;p.fromArray(L.position.data,3*N),g.fromArray(L.position.data,3*z),m.fromArray(L.position.data,3*D);var G=this.intersectTriangle(p,g,m,r,f,v,w);G&&(n&&G>T||(!F||G<F)&&(F=G,_=N,R=z,S=D,y.copy(w)))}F||c.splice(E,1),k.hit.localPoint.copy(v).multiply(F).add(f),k.hit.point.copy(k.hit.localPoint).applyMatrix4(k.worldMatrix),k.hit.distance=k.hit.point.distance(this.origin),k.hit.faceNormal||(k.hit.localFaceNormal=new I,k.hit.faceNormal=new I,k.hit.uv=new te,k.hit.localNormal=new I,k.hit.normal=new I),k.hit.localFaceNormal.copy(y),k.hit.faceNormal.copy(k.hit.localFaceNormal).transformDirection(k.worldMatrix),(s||h)&&(p.fromArray(L.position.data,3*_),g.fromArray(L.position.data,3*R),m.fromArray(L.position.data,3*S),this.getBarycoord(k.hit.localPoint,p,g,m,x)),s&&L.uv&&(b.fromArray(L.uv.data,2*_),A.fromArray(L.uv.data,2*R),M.fromArray(L.uv.data,2*S),k.hit.uv.set(b.x*x.x+A.x*x.y+M.x*x.z,b.y*x.x+A.y*x.y+M.y*x.z)),h&&L.normal&&(p.fromArray(L.normal.data,3*_),g.fromArray(L.normal.data,3*R),m.fromArray(L.normal.data,3*S),k.hit.localNormal.set(p.x*x.x+g.x*x.y+m.x*x.z,p.y*x.x+g.y*x.y+m.y*x.z,p.z*x.x+g.z*x.y+m.z*x.z),k.hit.normal.copy(k.hit.localNormal).transformDirection(k.worldMatrix))}return c.sort((function(t,e){return t.hit.distance-e.hit.distance})),c}},{key:"intersectSphere",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction,r=be;r.sub(t.center,e);var n=r.dot(i),a=r.dot(r)-n*n,s=t.radius*t.radius;if(a>s)return 0;var o=Math.sqrt(s-a),h=n-o,u=n+o;return h<0&&u<0?0:h<0?u:h}},{key:"intersectBox",value:function(t){var e,i,r,n,a,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction,u=1/h.x,l=1/h.y,c=1/h.z,d=t.min,f=t.max;return e=((u>=0?d.x:f.x)-o.x)*u,i=((u>=0?f.x:d.x)-o.x)*u,r=((l>=0?d.y:f.y)-o.y)*l,e>(n=((l>=0?f.y:d.y)-o.y)*l)||r>i?0:(r>e&&(e=r),n<i&&(i=n),a=((c>=0?d.z:f.z)-o.z)*c,e>(s=((c>=0?f.z:d.z)-o.z)*c)||a>i?0:(a>e&&(e=a),s<i&&(i=s),i<0?0:e>=0?e:i))}},{key:"intersectTriangle",value:function(t,e,i){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.origin,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:this.direction,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ke,o=Te,h=Fe,u=_e;o.sub(e,t),h.sub(i,t),s.cross(o,h);var l,c=a.dot(s);if(!c)return 0;if(c>0){if(r)return 0;l=1}else l=-1,c=-c;u.sub(n,t);var d=l*a.dot(h.cross(u,h));if(d<0)return 0;var f=l*a.dot(o.cross(u));if(f<0)return 0;if(d+f>c)return 0;var v=-l*u.dot(s);return v<0?0:v/c}},{key:"getBarycoord",value:function(t,e,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Te,a=Fe,s=_e,o=Re;a.sub(r,e),s.sub(i,e),o.sub(t,e);var h=a.dot(a),u=a.dot(s),l=a.dot(o),c=s.dot(s),d=s.dot(o),f=h*c-u*u;if(0===f)return n.set(-2,-1,-1);var v=1/f,p=(c*l-u*d)*v,g=(h*d-u*l)*v;return n.set(1-p-g,g,p)}}]),t}(),Le="catmullrom",Oe="cubicbezier",Ce="quadraticbezier",Be=new I,Ie=new I,Ue=new I,Ne=new I;function ze(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.168,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.168;if(e<1?Be.sub(t[1],t[0]).scale(i).add(t[0]):Be.sub(t[e+1],t[e-1]).scale(i).add(t[e]),e>t.length-3){var n=t.length-1;Ie.sub(t[n-1],t[n]).scale(r).add(t[n])}else Ie.sub(t[e],t[e+2]).scale(r).add(t[e+1]);return[Be.clone(),Ie.clone()]}function De(t,e,i,r){var n=1-t;Be.copy(e).scale(Math.pow(n,2)),Ie.copy(i).scale(2*n*t),Ue.copy(r).scale(Math.pow(t,2));var a=new I;return a.add(Be,Ie).add(Ue),a}function Ge(t,e,i,r,n){var a=1-t;Be.copy(e).scale(Math.pow(a,3)),Ie.copy(i).scale(3*Math.pow(a,2)*t),Ue.copy(r).scale(3*a*Math.pow(t,2)),Ne.copy(n).scale(Math.pow(t,3));var s=new I;return s.add(Be,Ie).add(Ue).add(Ne),s}var je=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.points,r=void 0===i?[new I(0,0,0),new I(0,1,0),new I(1,1,0),new I(1,0,0)]:i,a=e.divisions,s=void 0===a?12:a,o=e.type,h=void 0===o?Le:o;n(this,t),this.points=r,this.divisions=s,this.type=h}return s(t,[{key:"_getQuadraticBezierPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.divisions,e=[],i=this.points.length;if(i<3)return console.warn("Not enough points provided."),[];for(var r=this.points[0],n=this.points[1],a=this.points[2],s=0;s<=t;s++){var o=De(s/t,r,n,a);e.push(o)}for(var h=3;i-h>0;){r.copy(a),n=a.scale(2).sub(n),a=this.points[h];for(var u=1;u<=t;u++){var l=De(u/t,r,n,a);e.push(l)}h++}return e}},{key:"_getCubicBezierPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.divisions,e=[],i=this.points.length;if(i<4)return console.warn("Not enough points provided."),[];for(var r=this.points[0],n=this.points[1],a=this.points[2],s=this.points[3],o=0;o<=t;o++){var h=Ge(o/t,r,n,a,s);e.push(h)}for(var u=4;i-u>1;){r.copy(s),n=s.scale(2).sub(a),a=this.points[u],s=this.points[u+1];for(var l=1;l<=t;l++){var c=Ge(l/t,r,n,a,s);e.push(c)}u+=2}return e}},{key:"_getCatmullRomPoints",value:function(){var e,i=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.divisions,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.168,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.168,s=[],o=this.points.length;return o<=2?this.points:(this.points.forEach((function(o,h){if(0===h)e=o;else{var u=m(ze(i.points,h-1,n,a),2),l=u[0],c=u[1],d=new t({points:[e,l,c,o],type:Oe});s.pop(),s.push.apply(s,y(d.getPoints(r))),e=o}})),s)}},{key:"getPoints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.divisions,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.168,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.168,r=this.type;return r===Ce?this._getQuadraticBezierPoints(t):r===Oe?this._getCubicBezierPoints(t):r===Le?this._getCatmullRomPoints(t,e,i):this.points}}]),t}();je.CATMULLROM=Le,je.CUBICBEZIER=Oe,je.QUADRATICBEZIER=Ce;var Ve=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.width,a=i.height,s=i.dpr,o=i.wrapS,h=void 0===o?e.CLAMP_TO_EDGE:o,u=i.wrapT,l=void 0===u?e.CLAMP_TO_EDGE:u,c=i.minFilter,d=void 0===c?e.LINEAR:c,f=i.magFilter,v=void 0===f?e.LINEAR:f,p=i.geometry,g=void 0===p?new se(e):p,m=i.targetOnly,y=void 0===m?null:m;n(this,t),this.gl=e,this.options={wrapS:h,wrapT:l,minFilter:d,magFilter:v},this.passes=[],this.geometry=g,this.uniform={value:null},this.targetOnly=y;var w=this.fbo={read:null,write:null,swap:function(){var t=w.read;w.read=w.write,w.write=t}};this.resize({width:r,height:a,dpr:s})}return s(t,[{key:"addPass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertex,i=void 0===e?Xe:e,r=t.fragment,n=void 0===r?qe:r,a=t.uniforms,s=void 0===a?{}:a,o=t.textureUniform,h=void 0===o?"tMap":o,u=t.enabled,l=void 0===u||u;s[h]={value:this.fbo.read.texture};var c=new X(this.gl,{vertex:i,fragment:n,uniforms:s}),d=new Ct(this.gl,{geometry:this.geometry,program:c}),f={mesh:d,program:c,uniforms:s,enabled:l,textureUniform:h};return this.passes.push(f),f}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,i=t.height,r=t.dpr;r&&(this.dpr=r),e&&(this.width=e,this.height=i||e),r=this.dpr||this.gl.renderer.dpr,e=Math.floor((this.width||this.gl.renderer.width)*r),i=Math.floor((this.height||this.gl.renderer.height)*r),this.options.width=e,this.options.height=i,this.fbo.read=new zt(this.gl,this.options),this.fbo.write=new zt(this.gl,this.options)}},{key:"render",value:function(t){var e=this,i=t.scene,r=t.camera,n=t.texture,a=t.target,s=void 0===a?null:a,o=t.update,h=void 0===o||o,u=t.sort,l=void 0===u||u,c=t.frustumCull,d=void 0===c||c,f=this.passes.filter((function(t){return t.enabled}));n||(this.gl.renderer.render({scene:i,camera:r,target:f.length||!s&&this.targetOnly?this.fbo.write:s,update:h,sort:l,frustumCull:d}),this.fbo.swap()),f.forEach((function(t,i){t.mesh.program.uniforms[t.textureUniform].value=!i&&n?n:e.fbo.read.texture,e.gl.renderer.render({scene:t.mesh,target:i!==f.length-1||!s&&e.targetOnly?e.fbo.write:s,clear:!0}),e.fbo.swap()})),this.uniform.value=this.fbo.read.texture}}]),t}(),Xe="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",qe="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",Ye=new I,We=new ht,He=new I,Ze=new I,Qe=new ht,Ke=new I,$e=function(){function t(e){var i=e.objects,r=e.data;n(this,t),this.objects=i,this.data=r,this.elapsed=0,this.weight=1,this.duration=r.frames.length-1}return s(t,[{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1?arguments[1]:void 0,i=e?1:this.weight/t,r=this.elapsed%this.duration,n=Math.floor(r),a=r-n,s=this.data.frames[n],o=this.data.frames[(n+1)%this.duration];this.objects.forEach((function(t,e){Ye.fromArray(s.position,3*e),We.fromArray(s.quaternion,4*e),He.fromArray(s.scale,3*e),Ze.fromArray(o.position,3*e),Qe.fromArray(o.quaternion,4*e),Ke.fromArray(o.scale,3*e),Ye.lerp(Ze,a),We.slerp(Qe,a),He.lerp(Ke,a),t.position.lerp(Ye,i),t.quaternion.slerp(We,i),t.scale.lerp(He,i)}))}}]),t}(),Je=new yt,ti=function(t){o(i,t);var e=p(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.rig,o=a.geometry,h=a.program,u=a.mode,l=void 0===u?t.TRIANGLES:u;return n(this,i),(r=e.call(this,t,{geometry:o,program:h,mode:l})).createBones(s),r.createBoneTexture(),r.animations=[],Object.assign(r.program.uniforms,{boneTexture:{value:r.boneTexture},boneTextureSize:{value:r.boneTextureSize}}),r}return s(i,[{key:"createBones",value:function(t){var e=this;if(this.root=new At,this.bones=[],t.bones&&t.bones.length){for(var i=0;i<t.bones.length;i++){var r=new At;r.position.fromArray(t.bindPose.position,3*i),r.quaternion.fromArray(t.bindPose.quaternion,4*i),r.scale.fromArray(t.bindPose.scale,3*i),this.bones.push(r)}t.bones.forEach((function(t,i){if(e.bones[i].name=t.name,-1===t.parent)return e.bones[i].setParent(e.root);e.bones[i].setParent(e.bones[t.parent])})),this.root.updateMatrixWorld(!0),this.bones.forEach((function(t){t.bindInverse=c(yt,y(t.worldMatrix)).inverse()}))}}},{key:"createBoneTexture",value:function(){if(this.bones.length){var t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new Nt(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,width:t})}}},{key:"addAnimation",value:function(t){var e=new $e({objects:this.bones,data:t});return this.animations.push(e),e}},{key:"update",value:function(){var t=0;this.animations.forEach((function(e){return t+=e.weight})),this.animations.forEach((function(e,i){e.update(t,0===i)}))}},{key:"draw",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.camera;this.root.updateMatrixWorld(!0),this.bones.forEach((function(e,i){Je.multiply(e.worldMatrix,e.bindInverse),t.boneMatrices.set(Je,16*i)})),this.boneTexture&&(this.boneTexture.needsUpdate=!0),g(h(i.prototype),"draw",this).call(this,{camera:r})}}]),i}(Ct);function ei(t){return new X(t,{vertex:"\n    precision highp float;\n    precision highp int;\n\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    uniform mat3 normalMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vNormal;\n\n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    precision highp int;\n\n    varying vec3 vNormal;\n\n    void main() {\n        gl_FragColor.rgb = normalize(vNormal);\n        gl_FragColor.a = 1.0;\n    }\n",cullFace:null})}var ii=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.size,a=void 0===r?128:r,s=i.falloff,o=void 0===s?.3:s,h=i.alpha,u=void 0===h?1:h,l=i.dissipation,c=void 0===l?.98:l,d=i.type;n(this,t);var f=this;function v(){d||(d=e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES);var t=e.renderer.isWebgl2||e.renderer.extensions["OES_texture_".concat(d===e.FLOAT?"":"half_","float_linear")]?e.LINEAR:e.NEAREST,i={width:a,height:a,type:d,format:e.RGBA,internalFormat:e.renderer.isWebgl2?d===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA,minFilter:t,depth:!1};f.mask.read=new zt(e,i),f.mask.write=new zt(e,i),f.mask.swap()}function p(){return new Ct(e,{geometry:new se(e),program:new X(e,{vertex:ri,fragment:ni,uniforms:{tMap:f.uniform,uFalloff:{value:.5*o},uAlpha:{value:u},uDissipation:{value:c},uAspect:{value:1},uMouse:{value:f.mouse},uVelocity:{value:f.velocity}},depthTest:!1})})}this.gl=e,this.uniform={value:null},this.mask={read:null,write:null,swap:function(){var t=f.mask.read;f.mask.read=f.mask.write,f.mask.write=t,f.uniform.value=f.mask.read.texture}},v(),this.aspect=1,this.mouse=new te,this.velocity=new te,this.mesh=p()}return s(t,[{key:"update",value:function(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}}]),t}(),ri="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",ni="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n",ai=function(){function t(e,i){var r=this,a=i.data,s=void 0===a?new Float32Array(16):a,o=i.geometry,h=void 0===o?new se(e):o,u=i.type;n(this,t),this.gl=e;var l=s;this.passes=[],this.geometry=h,this.dataLength=l.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(var c=0;c<this.dataLength;c++){var d=c%this.size/this.size,f=Math.floor(c/this.size)/this.size;this.coords.set([d,f],2*c)}var v=function(){if(l.length===r.size*r.size*4)return l;var t=new Float32Array(r.size*r.size*4);return t.set(l),t}();this.uniform={value:new Nt(e,{image:v,target:e.TEXTURE_2D,type:e.FLOAT,format:e.RGBA,internalFormat:e.renderer.isWebgl2?e.RGBA32F:e.RGBA,wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:e.NEAREST,magFilter:e.NEAREST,width:this.size,flipY:!1})};var p={width:this.size,height:this.size,type:u||e.HALF_FLOAT||e.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES,format:e.RGBA,internalFormat:e.renderer.isWebgl2?u===e.FLOAT?e.RGBA32F:e.RGBA16F:e.RGBA,minFilter:e.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new zt(e,p),write:new zt(e,p),swap:function(){var t=r.fbo.read;r.fbo.read=r.fbo.write,r.fbo.write=t,r.uniform.value=r.fbo.read.texture}}}return s(t,[{key:"addPass",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.vertex,i=void 0===e?si:e,r=t.fragment,n=void 0===r?oi:r,a=t.uniforms,s=void 0===a?{}:a,o=t.textureUniform,h=void 0===o?"tMap":o,u=t.enabled,l=void 0===u||u;s[h]=this.uniform;var c=new X(this.gl,{vertex:i,fragment:n,uniforms:s}),d=new Ct(this.gl,{geometry:this.geometry,program:c}),f={mesh:d,program:c,uniforms:s,enabled:l,textureUniform:h};return this.passes.push(f),f}},{key:"render",value:function(){var t=this;this.passes.filter((function(t){return t.enabled})).forEach((function(e,i){t.gl.renderer.render({scene:e.mesh,target:t.fbo.write,clear:!1}),t.fbo.swap()}))}}]),t}(),si="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",oi="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",hi=new I,ui=function(){function t(e,i){var r=i.points,a=i.vertex,s=void 0===a?li:a,o=i.fragment,h=void 0===o?ci:o,u=i.uniforms,l=void 0===u?{}:u,c=i.attributes,d=void 0===c?{}:c;n(this,t),this.gl=e,this.points=r,this.count=r.length,this.position=new Float32Array(3*this.count*2),this.prev=new Float32Array(3*this.count*2),this.next=new Float32Array(3*this.count*2);for(var f=new Float32Array(1*this.count*2),v=new Float32Array(2*this.count*2),p=new Uint16Array(3*(this.count-1)*2),g=0;g<this.count;g++){f.set([-1,1],2*g);var m=g/(this.count-1);if(v.set([0,m,1,m],4*g),g!==this.count-1){var y=2*g;p.set([y+0,y+1,y+2],3*(y+0)),p.set([y+2,y+1,y+3],3*(y+1))}}var w=this.geometry=new G(e,Object.assign(d,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:f},uv:{size:2,data:v},index:{size:1,data:p}}));this.updateGeometry(),l.uResolution||(this.resolution=l.uResolution={value:new te}),l.uDPR||(this.dpr=l.uDPR={value:1}),l.uThickness||(this.thickness=l.uThickness={value:1}),l.uColor||(this.color=l.uColor={value:new qt("#000")}),l.uMiter||(this.miter=l.uMiter={value:1}),this.resize();var x=this.program=new X(e,{vertex:s,fragment:h,uniforms:l});this.mesh=new Ct(e,{geometry:w,program:x})}return s(t,[{key:"updateGeometry",value:function(){var t=this;this.points.forEach((function(e,i){e.toArray(t.position,3*i*2),e.toArray(t.position,3*i*2+3),i?(e.toArray(t.next,3*(i-1)*2),e.toArray(t.next,3*(i-1)*2+3)):(hi.copy(e).sub(t.points[i+1]).add(e),hi.toArray(t.prev,3*i*2),hi.toArray(t.prev,3*i*2+3)),i===t.points.length-1?(hi.copy(e).sub(t.points[i-1]).add(e),hi.toArray(t.next,3*i*2),hi.toArray(t.next,3*i*2+3)):(e.toArray(t.prev,3*(i+1)*2),e.toArray(t.prev,3*(i+1)*2+3))})),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}},{key:"resize",value:function(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}}]),t}(),li="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",ci="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n",di=function(){function t(e,i){var r=i.light,a=void 0===r?new Tt(e):r,s=i.width,o=void 0===s?1024:s,h=i.height,u=void 0===h?o:h;n(this,t),this.gl=e,this.light=a,this.target=new zt(e,{width:o,height:u}),this.depthProgram=new X(e,{vertex:fi,fragment:vi,cullFace:null}),this.castMeshes=[]}return s(t,[{key:"add",value:function(t){var e=t.mesh,i=t.receive,r=void 0===i||i,n=t.cast,a=void 0===n||n,s=t.vertex,o=void 0===s?fi:s,h=t.fragment,u=void 0===h?vi:h,l=t.uniformProjection,c=void 0===l?"shadowProjectionMatrix":l,d=t.uniformView,f=void 0===d?"shadowViewMatrix":d,v=t.uniformTexture,p=void 0===v?"tShadow":v;r&&!e.program.uniforms[c]&&(e.program.uniforms[c]={value:this.light.projectionMatrix},e.program.uniforms[f]={value:this.light.viewMatrix},e.program.uniforms[p]={value:this.target.texture}),a&&(this.castMeshes.push(e),e.colorProgram=e.program,e.depthProgram||(e.depthProgram=o!==fi||u!==vi?new X(this.gl,{vertex:o,fragment:u,cullFace:null}):this.depthProgram))}},{key:"render",value:function(t){var e=this,i=t.scene;i.traverse((function(t){t.draw&&(~e.castMeshes.indexOf(t)?t.program=t.depthProgram:(t.isForceVisibility=t.visible,t.visible=!1))})),this.gl.renderer.render({scene:i,camera:this.light,target:this.target}),i.traverse((function(t){t.draw&&(~e.castMeshes.indexOf(t)?t.program=t.colorProgram:t.visible=t.isForceVisibility)}))}}]),t}(),fi="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",vi="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n",pi=function(t){o(i,t);var e=p(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.buffer,o=a.wrapS,h=void 0===o?t.CLAMP_TO_EDGE:o,u=a.wrapT,l=void 0===u?t.CLAMP_TO_EDGE:u,c=a.anisotropy,d=void 0===c?0:c,f=a.minFilter,p=a.magFilter;return n(this,i),r=e.call(this,t,{generateMipmaps:!1,wrapS:h,wrapT:l,anisotropy:d,minFilter:f,magFilter:p}),s?v(r,r.parseBuffer(s)):r}return s(i,[{key:"parseBuffer",value:function(t){var e=new gi(t);e.mipmaps.isCompressedTexture=!0,this.image=e.mipmaps,this.internalFormat=e.glInternalFormat,e.numberOfMipmapLevels>1?this.minFilter===this.gl.LINEAR&&(this.minFilter=this.gl.NEAREST_MIPMAP_LINEAR):this.minFilter===this.gl.NEAREST_MIPMAP_LINEAR&&(this.minFilter=this.gl.LINEAR)}}]),i}(Nt);function gi(t){for(var e=[171,75,84,88,32,49,49,187,13,10,26,10],i=new Uint8Array(t,0,12),r=0;r<i.length;r++)if(i[r]!==e[r])return console.error("File missing KTX identifier");var n=Uint32Array.BYTES_PER_ELEMENT,a=new DataView(t,12,13*n),s=67305985===a.getUint32(0,!0);if(0!==a.getUint32(1*n,s))return console.warn("only compressed formats currently supported");this.glInternalFormat=a.getUint32(4*n,s);var o=a.getUint32(6*n,s),h=a.getUint32(7*n,s);this.numberOfFaces=a.getUint32(10*n,s),this.numberOfMipmapLevels=Math.max(1,a.getUint32(11*n,s));var u=a.getUint32(12*n,s);this.mipmaps=[];for(var l=64+u,c=0;c<this.numberOfMipmapLevels;c++){var d=new Int32Array(t,l,1)[0];l+=4;for(var f=0;f<this.numberOfFaces;f++){var v=new Uint8Array(t,l,d);this.mipmaps.push({data:v,width:o,height:h}),l+=d,l+=3-(d+3)%4}o>>=1,h>>=1}}var mi={},yi=[],wi=function(){function t(){n(this,t)}return s(t,null,[{key:"load",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.src,n=i.wrapS,a=void 0===n?t.CLAMP_TO_EDGE:n,s=i.wrapT,o=void 0===s?t.CLAMP_TO_EDGE:s,h=i.anisotropy,u=void 0===h?0:h,l=i.format,c=void 0===l?t.RGBA:l,d=i.internalFormat,f=void 0===d?c:d,v=i.generateMipmaps,p=void 0===v||v,g=i.minFilter,m=void 0===g?p?t.NEAREST_MIPMAP_LINEAR:t.LINEAR:g,y=i.magFilter,w=void 0===y?t.LINEAR:y,x=i.premultiplyAlpha,b=void 0!==x&&x,A=i.unpackAlignment,M=void 0===A?4:A,E=i.flipY,k=void 0===E||E,T=this.getSupportedExtensions(t),F="none";if("string"==typeof r&&(F=r.split(".").pop().split("?")[0].toLowerCase()),"object"===e(r))for(var _ in r)if(T.includes(_.toLowerCase())){F=_.toLowerCase(),r=r[_];break}var R,S=r+a+o+u+c+f+p+m+w+b+M+k+t.renderer.id;if(mi[S])return mi[S];switch(F){case"ktx":case"pvrtc":case"s3tc":case"etc":case"etc1":case"astc":(R=new pi(t,{src:r,wrapS:a,wrapT:o,anisotropy:u,minFilter:m,magFilter:w})).loaded=this.loadKTX(r,R);break;case"webp":case"jpg":case"jpeg":case"png":(R=new Nt(t,{wrapS:a,wrapT:o,anisotropy:u,format:c,internalFormat:f,generateMipmaps:p,minFilter:m,magFilter:w,premultiplyAlpha:b,unpackAlignment:M,flipY:k})).loaded=this.loadImage(t,r,R);break;default:console.warn("No supported format supplied"),R=new Nt(t)}return R.ext=F,mi[S]=R,R}},{key:"getSupportedExtensions",value:function(t){if(yi.length)return yi;var e={pvrtc:t.renderer.getExtension("WEBGL_compressed_texture_pvrtc")||t.renderer.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),s3tc:t.renderer.getExtension("WEBGL_compressed_texture_s3tc"),etc1:t.renderer.getExtension("WEBGL_compressed_texture_etc1"),astc:t.renderer.getExtension("WEBGL_compressed_texture_astc"),bc7:t.renderer.getExtension("EXT_texture_compression_bptc")};for(var i in e)e[i]&&yi.push(i);return 0==document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")&&yi.push("webp"),yi.push("png","jpg"),yi}},{key:"loadKTX",value:function(t,e){return fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return e.parseBuffer(t)}))}},{key:"loadImage",value:function(t,e,i){return function(t){return new Promise((function(e){var i=navigator.userAgent.toLowerCase().includes("chrome");if(window.createImageBitmap&&i)fetch(t,{mode:"cors"}).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,{imageOrientation:"flipY",premultiplyAlpha:"none"})})).then(e);else{var r=new Image;r.crossOrigin="",r.src=t,r.onload=function(){return e(r)}}}))}(e).then((function(e){return xi(e.width)&&xi(e.height)||(i.generateMipmaps&&(i.generateMipmaps=!1),i.minFilter===t.NEAREST_MIPMAP_LINEAR&&(i.minFilter=t.LINEAR),i.wrapS===t.REPEAT&&(i.wrapS=i.wrapT=t.CLAMP_TO_EDGE)),i.image=e,i.onUpdate=function(){e.close&&e.close(),i.onUpdate=null},e}))}},{key:"clearCache",value:function(){mi={}}}]),t}();function xi(t){return Math.log2(t)%1==0}var bi=new I,Ai=new I,Mi=new I,Ei=new I,ki=new ht,Ti=new ht,Fi=new ht,_i=new ht,Ri=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;n(this,t),this.data=e,this.elapsed=0,this.weight=i,this.loop=!0,this.startTime=e.reduce((function(t,e){var i=e.times;return Math.min(t,i[0])}),1/0),this.endTime=e.reduce((function(t,e){var i=e.times;return Math.max(t,i[i.length-1])}),0),this.duration=this.endTime-this.startTime}return s(t,[{key:"update",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1?arguments[1]:void 0,r=i?1:this.weight/e,n=(this.loop?this.elapsed%this.duration:Math.min(this.elapsed,this.duration-.001))+this.startTime;this.data.forEach((function(e){var i=e.node,a=e.transform,s=e.interpolation,o=e.times,h=e.values,u=Math.max(1,o.findIndex((function(t){return t>n})))-1,l=u+1,c=(n-o[u])/(o[l]-o[u]);"STEP"===s&&(c=0);var d=bi,f=Ai,v=Mi,p=Ei,g=3;"quaternion"===a&&(d=ki,f=Ti,v=Fi,p=_i,g=4),"CUBICSPLINE"===s?(d.fromArray(h,u*g*3+1*g),f.fromArray(h,u*g*3+2*g),v.fromArray(h,l*g*3+0*g),p.fromArray(h,l*g*3+1*g),d=t.cubicSplineInterpolate(c,d,f,v,p),4===g&&d.normalize()):(d.fromArray(h,u*g),p.fromArray(h,l*g),4===g?d.slerp(p,c):d.lerp(p,c)),4===g?i[a].slerp(d,r):i[a].lerp(d,r)}))}},{key:"cubicSplineInterpolate",value:function(t,e,i,r,n){for(var a=t*t,s=a*t,o=3*a-2*s,h=s-a,u=1-o,l=h-a+t,c=0;c<e.length;c++)e[c]=u*e[c]+l*(1-t)*i[c]+o*n[c]+h*t*r[c];return e}}]),t}(),Si=new yt,Pi=new yt,Li=function(t){o(i,t);var e=p(i);function i(t){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=a.skeleton,o=a.geometry,h=a.program,u=a.mode,l=void 0===u?t.TRIANGLES:u;return n(this,i),(r=e.call(this,t,{geometry:o,program:h,mode:l})).skeleton=s,r.program=h,r.createBoneTexture(),r.animations=[],r}return s(i,[{key:"createBoneTexture",value:function(){if(this.skeleton.joints.length){var t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.skeleton.joints.length))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new Nt(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA32F:this.gl.RGBA,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,flipY:!1,width:t})}}},{key:"updateUniforms",value:function(){var t=this;this.skeleton.joints.forEach((function(e,i){Si.multiply(e.worldMatrix,e.bindInverse),t.boneMatrices.set(Si,16*i)})),this.boneTexture&&(this.boneTexture.needsUpdate=!0)}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.camera;this.program.uniforms.boneTexture||Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}}),this.updateUniforms();var r=this.worldMatrix;this.worldMatrix=Pi,g(h(i.prototype),"draw",this).call(this,{camera:e}),this.worldMatrix=r}}]),i}(Ct),Oi={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array},Ci={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Bi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ii={translation:"position",rotation:"quaternion",scale:"scale"},Ui=function(){function t(){n(this,t)}var e,i,a,o;return s(t,null,[{key:"load",value:(o=r(regeneratorRuntime.mark((function t(e,i){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.split("/").slice(0,-1).join("/")+"/",t.next=3,this.parseDesc(i);case 3:return n=t.sent,t.next=6,this.parse(e,n,r);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return o.apply(this,arguments)})},{key:"parse",value:(a=r(regeneratorRuntime.mark((function t(e,i,r){var n,a,s,o,h,u,l,c,d,f,v,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(void 0===i.asset||i.asset.version[0]<2)&&console.warn("Only GLTF >=2.0 supported. Attempting to parse."),t.next=3,this.loadBuffers(i,r);case 3:for(n=t.sent,e.renderer.bindVertexArray(null),a=this.parseBufferViews(e,i,n),s=this.parseImages(e,i,r,a),o=this.parseTextures(e,i,s),h=this.parseMaterials(e,i,o),u=this.parseSkins(e,i,a),l=this.parseMeshes(e,i,a,h,u),c=this.parseNodes(e,i,l,u),this.populateSkins(u,c),d=this.parseAnimations(e,i,c,a),f=this.parseScenes(i,c),v=f[i.scene],p=c.length;p>=0;p--)c[p]||c.splice(p,1);return t.abrupt("return",{json:i,buffers:n,bufferViews:a,images:s,textures:o,materials:h,meshes:l,nodes:c,animations:d,scenes:f,scene:v});case 18:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return a.apply(this,arguments)})},{key:"parseDesc",value:(i=r(regeneratorRuntime.mark((function t(e){var i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.match(/\.glb/)){t.next=6;break}return t.next=3,fetch(e).then((function(t){return t.json()}));case 3:return t.abrupt("return",t.sent);case 6:return t.next=8,fetch(e).then((function(t){return t.arrayBuffer()})).then((function(t){return i.unpackGLB(t)}));case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)}))),function(t){return i.apply(this,arguments)})},{key:"unpackGLB",value:function(t){var e=new Uint32Array(t,0,3);if(1179937895!==e[0])throw new Error("Invalid glTF asset.");if(2!==e[1])throw new Error('Unsupported glTF binary version, "'.concat(e[1],'".'));var i=new Uint32Array(t,12,2),r=i[0];if(1313821514!==i[1])throw new Error("Unexpected GLB layout.");var n=(new TextDecoder).decode(t.slice(20,20+r)),a=JSON.parse(n);if(20+r===t.byteLength)return a;var s=new Uint32Array(t,20+r,2);if(5130562!==s[1])throw new Error("Unexpected GLB layout.");var o=20+r+8,h=s[0],u=t.slice(o,o+h);return a.buffers[0].binary=u,a}},{key:"resolveURI",value:function(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}},{key:"loadBuffers",value:(e=r(regeneratorRuntime.mark((function t(e,i){var r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.buffers){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,Promise.all(e.buffers.map((function(t){if(t.binary)return t.binary;var e=r.resolveURI(t.uri,i);return fetch(e).then((function(t){return t.arrayBuffer()}))})));case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)}))),function(t,i){return e.apply(this,arguments)})},{key:"parseBufferViews",value:function(t,e,i){if(!e.bufferViews)return null;var r=e.bufferViews.map((function(t){return Object.assign({},t)}));return e.meshes&&e.meshes.forEach((function(i){i.primitives.forEach((function(i){var n=i.attributes,a=i.indices;for(var s in n)r[e.accessors[n[s]].bufferView].isAttribute=!0;void 0!==a&&(r[e.accessors[a].bufferView].isAttribute=!0,r[e.accessors[a].bufferView].target=t.ELEMENT_ARRAY_BUFFER)}))})),e.accessors.forEach((function(t){var e=t.bufferView,i=t.componentType;r[e].componentType=i})),e.images&&e.images.forEach((function(t){t.uri;var e=t.bufferView,i=t.mimeType;void 0!==e&&(r[e].mimeType=i)})),r.forEach((function(e,n){var a=e.buffer,s=e.byteOffset,o=void 0===s?0:s,h=e.byteLength;e.byteStride;var u=e.target,l=void 0===u?t.ARRAY_BUFFER:u;e.name,e.extensions,e.extras;var c=e.componentType,d=e.mimeType,f=e.isAttribute,v=Oi[c||d],p=v.BYTES_PER_ELEMENT,g=new v(i[a],o,h/p);if(r[n].data=g,r[n].originalBuffer=i[a],f){var m=t.createBuffer();t.bindBuffer(l,m),t.renderer.state.boundBuffer=m,t.bufferData(l,g,t.STATIC_DRAW),r[n].buffer=m}})),r}},{key:"parseImages",value:function(t,e,i,r){var n=this;return e.images?e.images.map((function(t){var e=t.uri,a=t.bufferView,s=t.mimeType,o=t.name,h=new Image;if(h.name=o,e)h.src=n.resolveURI(e,i);else if(void 0!==a){var u=r[a].data,l=new Blob([u],{type:s});h.src=URL.createObjectURL(l)}return h.ready=new Promise((function(t){h.onload=function(){return t()}})),h})):null}},{key:"parseTextures",value:function(t,e,i){return e.textures?e.textures.map((function(r){var n=r.sampler,a=r.source,s=r.name;r.extensions,r.extras;var o={flipY:!1,wrapS:t.REPEAT,wrapT:t.REPEAT},h=void 0!==n?e.samplers[n]:null;h&&["magFilter","minFilter","wrapS","wrapT"].forEach((function(t){h[t]&&(o[t]=h[t])}));var u=new Nt(t,o);u.name=s;var l=i[a];return l.ready.then((function(){return u.image=l})),u})):null}},{key:"parseMaterials",value:function(t,e,i){return e.materials?e.materials.map((function(t){var e=t.name;t.extensions,t.extras;var r=t.pbrMetallicRoughness,n=void 0===r?{}:r,a=t.normalTexture,s=t.occlusionTexture,o=t.emissiveTexture,h=t.emissiveFactor,u=void 0===h?[0,0,0]:h,l=t.alphaMode,c=void 0===l?"OPAQUE":l,d=t.alphaCutoff,f=void 0===d?.5:d,v=t.doubleSided,p=void 0!==v&&v,g=n.baseColorFactor,m=void 0===g?[1,1,1,1]:g,y=n.baseColorTexture,w=n.metallicFactor,x=void 0===w?1:w,b=n.roughnessFactor,A=void 0===b?1:b,M=n.metallicRoughnessTexture;return y&&(y.texture=i[y.index]),a&&(a.texture=i[a.index]),M&&(M.texture=i[M.index]),s&&(s.texture=i[s.index]),o&&(o.texture=i[o.index]),{name:e,baseColorFactor:m,baseColorTexture:y,metallicFactor:x,roughnessFactor:A,metallicRoughnessTexture:M,normalTexture:a,occlusionTexture:s,emissiveTexture:o,emissiveFactor:u,alphaMode:c,alphaCutoff:f,doubleSided:p}})):null}},{key:"parseSkins",value:function(t,e,i){var r=this;return e.skins?e.skins.map((function(t){var n=t.inverseBindMatrices,a=t.skeleton,s=t.joints;return{inverseBindMatrices:r.parseAccessor(n,e,i),skeleton:a,joints:s}})):null}},{key:"parseMeshes",value:function(t,e,i,r,n){var a=this;return e.meshes?e.meshes.map((function(s,o){var h=s.primitives,u=s.weights,l=s.name;s.extensions,s.extras;var c=0,d=!1;return e.nodes&&e.nodes.forEach((function(t){var e=t.mesh,i=t.skin;e===o&&(c++,void 0!==i&&(d=i))})),{primitives:h=a.parsePrimitives(t,h,e,i,r,c).map((function(e){var i=e.geometry,r=e.program,a=e.mode,s="number"==typeof d?new Li(t,{skeleton:n[d],geometry:i,program:r,mode:a}):new Ct(t,{geometry:i,program:r,mode:a});return s.name=l,s.geometry.isInstanced&&(s.numInstances=c,s.frustumCulled=!1),s})),weights:u,name:l}})):null}},{key:"parsePrimitives",value:function(t,e,i,r,n,a){var s=this;return e.map((function(e){var o=e.attributes,h=e.indices,u=e.material,l=e.mode,c=void 0===l?4:l;e.targets,e.extensions,e.extras;var d=new G(t);for(var f in o)d.addAttribute(Bi[f],s.parseAccessor(o[f],i,r));void 0!==h&&d.addAttribute("index",s.parseAccessor(h,i,r)),a>1&&d.addAttribute("instanceMatrix",{instanced:1,size:16,data:new Float32Array(16*a)});var v=new ei(t);return void 0!==u&&(v.gltfMaterial=n[u]),{geometry:d,program:v,mode:c}}))}},{key:"parseAccessor",value:function(t,e,i){var r=e.accessors[t],n=r.bufferView,a=r.byteOffset,s=void 0===a?0:a,o=r.componentType,h=r.normalized,u=void 0!==h&&h,l=r.count,c=r.type,d=r.min,f=r.max;r.sparse;var v=i[n],p=v.data,g=v.originalBuffer,m=v.buffer,y=v.byteOffset,w=void 0===y?0:y,x=v.byteStride,b=void 0===x?0:x;v.target;var A=Ci[c],M=Oi[o],E=p.BYTES_PER_ELEMENT;return{data:!!b&&b/E!==A?p:new M(g,s+w,l*A),size:A,type:o,normalized:u,buffer:m,stride:b,offset:s,count:l,min:d,max:f}}},{key:"parseNodes",value:function(t,e,i,r){if(!e.nodes)return null;var n=e.nodes.map((function(t){t.camera,t.children,t.skin;var e=t.matrix,r=t.mesh,n=t.rotation,a=t.scale,s=t.translation;t.weights;var o=t.name;t.extensions,t.extras;var h=new At;o&&(h.name=o),e?(h.matrix.copy(e),h.decompose()):(n&&h.quaternion.copy(n),a&&h.scale.copy(a),s&&h.position.copy(s),h.updateMatrix());var u=!1,l=!0;if(void 0!==r&&i[r].primitives.forEach((function(t){t.geometry.isInstanced&&(u=!0,t.instanceCount?l=!1:t.instanceCount=0,h.matrix.toArray(t.geometry.attributes.instanceMatrix.data,16*t.instanceCount),t.instanceCount++,t.instanceCount===t.numInstances&&(delete t.numInstances,delete t.instanceCount,t.geometry.attributes.instanceMatrix.needsUpdate=!0)),u?l&&t.setParent(h):t.setParent(h)})),u){if(!l)return null;h.matrix.identity(),h.decompose()}return h}));return e.nodes.forEach((function(t,e){var i=t.children;(void 0===i?[]:i).forEach((function(t){n[t]&&n[t].setParent(n[e])}))})),n}},{key:"populateSkins",value:function(t,e){t&&t.forEach((function(t){t.joints=t.joints.map((function(i,r){var n=e[i];return n.bindInverse=c(yt,y(t.inverseBindMatrices.data.slice(16*r,16*(r+1)))),n})),t.skeleton&&(t.skeleton=e[t.skeleton])}))}},{key:"parseAnimations",value:function(t,e,i,r){var n=this;return e.animations?e.animations.map((function(t){var a=t.channels,s=t.samplers,o=t.name,h=a.map((function(t){var a=t.sampler,o=t.target,h=s[a],u=h.input,l=h.interpolation,c=void 0===l?"LINEAR":l,d=h.output,f=o.node,v=o.path;return{node:i[f],transform:Ii[v],interpolation:c,times:n.parseAccessor(u,e,r).data,values:n.parseAccessor(d,e,r).data}}));return{name:o,animation:new Ri(h)}})):null}},{key:"parseScenes",value:function(t,e){return t.scenes?t.scenes.map((function(t){var i=t.nodes,r=void 0===i?[]:i;return t.name,t.extensions,t.extras,r.reduce((function(t,i){return e[i]&&t.push(e[i]),t}),[])})):null}}]),t}();t.Animation=$e,t.Box=re,t.Camera=Tt,t.Color=qt,t.Curve=je,t.Cylinder=ae,t.Euler=bt,t.Flowmap=ii,t.GLTFLoader=Ui,t.GLTFSkin=Li,t.GPGPU=ai,t.Geometry=G,t.KTXTexture=pi,t.Mat3=Lt,t.Mat4=yt,t.Mesh=Ct,t.NormalProgram=ei,t.Orbit=function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.element,n=void 0===r?document:r,a=i.enabled,s=void 0===a||a,o=i.target,h=void 0===o?new I:o,u=i.ease,l=void 0===u?.25:u,c=i.inertia,d=void 0===c?.85:c,f=i.enableRotate,v=void 0===f||f,p=i.rotateSpeed,g=void 0===p?.1:p,m=i.autoRotate,y=void 0!==m&&m,w=i.autoRotateSpeed,x=void 0===w?1:w,b=i.enableZoom,A=void 0===b||b,M=i.zoomSpeed,E=void 0===M?1:M,k=i.zoomStyle,T=void 0===k?"dolly":k,F=i.enablePan,_=void 0===F||F,R=i.panSpeed,S=void 0===R?.1:R,P=i.minPolarAngle,L=void 0===P?0:P,O=i.maxPolarAngle,C=void 0===O?Math.PI:O,B=i.minAzimuthAngle,U=void 0===B?-1/0:B,N=i.maxAzimuthAngle,z=void 0===N?1/0:N,D=i.minDistance,G=void 0===D?0:D,j=i.maxDistance,V=void 0===j?1/0:j;this.enabled=s,this.target=h,this.zoomStyle=T,l=l||1,d=d||0,this.minDistance=G,this.maxDistance=V;var X={radius:1,phi:0,theta:0},q={radius:1,phi:0,theta:0},Y={radius:1,phi:0,theta:0},W=new I,H=new I;H.copy(t.position).sub(this.target),Y.radius=q.radius=H.distance(),Y.theta=q.theta=Math.atan2(H.x,H.z),Y.phi=q.phi=Math.acos(Math.min(Math.max(H.y/q.radius,-1),1)),this.offset=H,this.update=function(){y&&nt(),q.radius*=X.radius,q.theta+=X.theta,q.phi+=X.phi,q.theta=Math.max(U,Math.min(z,q.theta)),q.phi=Math.max(L,Math.min(C,q.phi)),q.radius=Math.max(e.minDistance,Math.min(e.maxDistance,q.radius)),Y.phi+=(q.phi-Y.phi)*l,Y.theta+=(q.theta-Y.theta)*l,Y.radius+=(q.radius-Y.radius)*l,e.target.add(W);var i=Y.radius*Math.sin(Math.max(1e-6,Y.phi));H.x=i*Math.sin(Y.theta),H.y=Y.radius*Math.cos(Y.phi),H.z=i*Math.cos(Y.theta),t.position.copy(e.target).add(H),t.lookAt(e.target),X.theta*=d,X.phi*=d,W.multiply(d),X.radius=1},this.forcePosition=function(){H.copy(t.position).sub(e.target),Y.radius=q.radius=H.distance(),Y.theta=q.theta=Math.atan2(H.x,H.z),Y.phi=q.phi=Math.acos(Math.min(Math.max(H.y/q.radius,-1),1)),t.lookAt(e.target)};var Z=new te,Q=new te,K=new te,$=he;function J(){return Math.pow(.95,E)}function tt(t,e){fe.set(e[0],e[1],e[2]),fe.multiply(-t),W.add(fe)}function et(t,e){fe.set(e[4],e[5],e[6]),fe.multiply(t),W.add(fe)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};var it=function(i,r){var a=n===document?document.body:n;fe.copy(t.position).sub(e.target);var s=fe.distance();tt(2*i*(s*=Math.tan((t.fov||45)/2*Math.PI/180))/a.clientHeight,t.matrix),et(2*r*s/a.clientHeight,t.matrix)},rt=function(i){"dolly"===e.zoomStyle?X.radius/=i:(t.fov/=i,"orthographic"===t.type?t.orthographic():t.perspective())};function nt(){var t=2*Math.PI/60/60*x;X.theta-=t}function at(t,e){ve.set(t,e),pe.sub(ve,Z).multiply(g);var i=n===document?document.body:n;X.theta-=2*Math.PI*pe.x/i.clientHeight,X.phi-=2*Math.PI*pe.y/i.clientHeight,Z.copy(ve)}function st(t){ve.set(t.clientX,t.clientY),pe.sub(ve,K),pe.y>0?rt(J()):pe.y<0&&rt(1/J()),K.copy(ve)}function ot(t,e){ve.set(t,e),pe.sub(ve,Q).multiply(S),it(pe.x,pe.y),Q.copy(ve)}function ht(t){if(A){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);K.set(0,r)}if(_){var n=.5*(t.touches[0].pageX+t.touches[1].pageX),a=.5*(t.touches[0].pageY+t.touches[1].pageY);Q.set(n,a)}}function ut(t){if(A){var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);ve.set(0,r),pe.set(0,Math.pow(ve.y/K.y,E)),rt(pe.y),K.copy(ve)}_&&ot(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}var lt=function(t){if(e.enabled){switch(t.button){case e.mouseButtons.ORBIT:if(!1===v)return;Z.set(t.clientX,t.clientY),$=ue;break;case e.mouseButtons.ZOOM:if(!1===A)return;K.set(t.clientX,t.clientY),$=le;break;case e.mouseButtons.PAN:if(!1===_)return;Q.set(t.clientX,t.clientY),$=ce}$!==he&&(window.addEventListener("mousemove",ct,!1),window.addEventListener("mouseup",dt,!1))}},ct=function(t){if(e.enabled)switch($){case ue:if(!1===v)return;at(t.clientX,t.clientY);break;case le:if(!1===A)return;st(t);break;case ce:if(!1===_)return;ot(t.clientX,t.clientY)}},dt=function t(){window.removeEventListener("mousemove",ct,!1),window.removeEventListener("mouseup",t,!1),$=he},ft=function(t){e.enabled&&A&&($===he||$===ue)&&(t.stopPropagation(),t.preventDefault(),t.deltaY<0?rt(1/J()):t.deltaY>0&&rt(J()))},vt=function(t){if(e.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===v)return;Z.set(t.touches[0].pageX,t.touches[0].pageY),$=ue;break;case 2:if(!1===A&&!1===_)return;ht(t),$=de;break;default:$=he}},pt=function(t){if(e.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===v)return;at(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===A&&!1===_)return;ut(t);break;default:$=he}},gt=function(){e.enabled&&($=he)},mt=function(t){e.enabled&&t.preventDefault()};function yt(){n.addEventListener("contextmenu",mt,!1),n.addEventListener("mousedown",lt,!1),n.addEventListener("wheel",ft,{passive:!1}),n.addEventListener("touchstart",vt,{passive:!1}),n.addEventListener("touchend",gt,!1),n.addEventListener("touchmove",pt,{passive:!1})}this.remove=function(){n.removeEventListener("contextmenu",mt),n.removeEventListener("mousedown",lt),n.removeEventListener("wheel",ft),n.removeEventListener("touchstart",vt),n.removeEventListener("touchend",gt),n.removeEventListener("touchmove",pt),window.removeEventListener("mousemove",ct),window.removeEventListener("mouseup",dt)},yt()},t.Plane=ie,t.Polyline=ui,t.Post=Ve,t.Program=X,t.Quat=ht,t.Raycast=Pe,t.RenderTarget=zt,t.Renderer=K,t.Shadow=di,t.Skin=ti,t.Sphere=ne,t.Text=function(t){var e,i,r,n,a=t.font,s=t.text,o=t.width,h=void 0===o?1/0:o,u=t.align,l=void 0===u?"left":u,c=t.size,d=void 0===c?1:c,f=t.letterSpacing,v=void 0===f?0:f,p=t.lineHeight,g=void 0===p?1.4:p,m=t.wordSpacing,w=void 0===m?0:m,x=t.wordBreak,b=void 0!==x&&x,A=this,M=/\n/,E=/\s/;function k(){a.common.lineHeight,r=a.common.base,n=d/r;var t=s.replace(/[ \n]/g,"").length;i={position:new Float32Array(4*t*3),uv:new Float32Array(4*t*2),id:new Float32Array(4*t),index:new Uint16Array(6*t)};for(var e=0;e<t;e++)i.id[e]=e,i.index.set([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3],6*e);T()}function T(){var t=[],r=0,o=0,u=0,c=f();function f(){var e={width:0,glyphs:[]};return t.push(e),o=r,u=0,e}for(var p=0;r<s.length&&p<100;){p++;var m=s[r];if(c.width||!E.test(m))if(M.test(m))r++,c=f();else{var x=e[m]||e[" "];if(c.glyphs.length){var k=c.glyphs[c.glyphs.length-1][0],T=F(x.id,k.id)*n;c.width+=T,u+=T}c.glyphs.push([x,c.width]);var _=0;if(E.test(m)?(o=r,u=0,_+=w*d):_+=v*d,_+=x.xadvance*n,c.width+=_,u+=_,c.width>h){if(b&&c.glyphs.length>1){c.width-=_,c.glyphs.pop(),c=f();continue}if(!b&&u!==c.width){var R=r-o+1;c.glyphs.splice(-R,R),r=o,c.width-=u,c=f();continue}}r++,p=0}else r++,o=r,u=0}c.width||t.pop(),function(t){for(var e=a.common.scaleW,r=a.common.scaleH,s=.07*d,o=0,h=0;h<t.length;h++){for(var u=t[h],c=0;c<u.glyphs.length;c++){var f=u.glyphs[c][0],v=u.glyphs[c][1];if("center"===l?v-=.5*u.width:"right"===l&&(v-=u.width),!E.test(f.char)){v+=f.xoffset*n,s-=f.yoffset*n;var p=f.width*n,m=f.height*n;i.position.set([v,s-m,0,v,s,0,v+p,s-m,0,v+p,s,0],4*o*3);var w=f.x/e,x=f.width/e,b=1-f.y/r,M=f.height/r;i.uv.set([w,b-M,w,b,w+x,b-M,w+x,b],4*o*2),s+=f.yoffset*n,o++}}s-=d*g}A.buffers=i,A.numLines=t.length,A.height=A.numLines*d*g,A.width=Math.max.apply(Math,y(t.map((function(t){return t.width}))))}(t)}function F(t,e){for(var i=0;i<a.kernings.length;i++){var r=a.kernings[i];if(!(r.first<t)&&!(r.second<e))return r.first>t||r.first===t&&r.second>e?0:r.amount}return 0}e={},a.chars.forEach((function(t){return e[t.char]=t})),k(),this.resize=function(t){h=t.width,T()},this.update=function(t){s=t.text,k()}},t.Texture=Nt,t.TextureLoader=wi,t.Torus=oe,t.Transform=At,t.Triangle=se,t.Vec2=te,t.Vec3=I,t.Vec4=ee}));
//# sourceMappingURL=ogl.min.js.map
